bun test v1.3.6 (d530ed99)

test/tool/websearch.test.ts:
(pass) tool.websearch permissions > asks for websearch permission with correct pattern [34.00ms]
(pass) tool.websearch permissions > includes numResults in permission metadata [14.00ms]
(pass) tool.websearch permissions > includes livecrawl in permission metadata [11.00ms]
(pass) tool.websearch permissions > includes type in permission metadata [14.00ms]
(pass) tool.websearch permissions > includes contextMaxCharacters in permission metadata [16.00ms]
(pass) tool.websearch integration > basic search returns results [26.00ms]

test/tool/edit.test.ts:
(pass) tool.edit > basic edit - replace single occurrence [186.00ms]
(pass) tool.edit > edit with replaceAll=true [19.00ms]
(pass) tool.edit > edit with replaceAll=false rejects multiple matches [19.00ms]
(pass) tool.edit > edit non-existent file throws error [17.00ms]
(pass) tool.edit > edit with empty oldString creates new file [15.00ms]
(pass) tool.edit > edit with same oldString and newString throws error [17.00ms]
(pass) tool.edit > edit directory path throws error [15.00ms]
(pass) tool.edit permissions > asks for edit permission with correct pattern [19.00ms]
(pass) tool.edit permissions > asks for external_directory permission for files outside project [21.00ms]
(pass) tool.edit unicode and special characters > edit with unicode characters [20.00ms]
(pass) tool.edit unicode and special characters > edit with line endings (CRLF) [18.00ms]
(pass) tool.edit unicode and special characters > edit multiline content [18.00ms]

test/tool/truncation.test.ts:
(pass) Truncate > output > truncates large json file by bytes [7.00ms]
(pass) Truncate > output > returns content unchanged when under limits
(pass) Truncate > output > truncates by line count [1.00ms]
(pass) Truncate > output > truncates by byte count
(pass) Truncate > output > truncates from head by default
(pass) Truncate > output > truncates from tail when direction is tail [1.00ms]
(pass) Truncate > output > uses default MAX_LINES and MAX_BYTES
(pass) Truncate > output > large single-line file truncates with byte message [3.00ms]
(pass) Truncate > output > writes full output to file when truncated [1.00ms]
(pass) Truncate > output > suggests Task tool when agent has task permission [1.00ms]
(pass) Truncate > output > omits Task tool hint when agent lacks task permission
(pass) Truncate > output > does not write file when not truncated
(pass) Truncate > cleanup > deletes files older than 7 days and preserves recent files [1.00ms]

test/tool/finance.test.ts:
(pass) finance.symbols > detectAssetType > detects crypto symbols correctly
(pass) finance.symbols > detectAssetType > detects stock symbols correctly
(pass) finance.symbols > detectAssetType > detects forex symbols correctly
(pass) finance.symbols > detectAssetType > detects commodity symbols correctly
(pass) finance.symbols > detectAssetType > detects index symbols correctly
(pass) finance.symbols > detectAssetType > returns correct ticker format
(pass) finance.symbols > detectAssetType > respects explicit type override
(pass) finance.symbols > utility functions > getAssetTypeEmoji returns an emoji [1.00ms]
(pass) finance.symbols > utility functions > getAssetTypeName returns Turkish name
(pass) finance.technical > analyzeKlines returns valid technical indicators [1.00ms]
(pass) finance.technical > analyzeKlines handles empty array
(pass) finance.technical > analyzeKlines handles short arrays
(pass) finance.technical > RSI calculation is correct for extreme cases
(pass) finance.logic > applySeniorLogic > calculates risk score correctly [1.00ms]
(pass) finance.logic > applySeniorLogic > generates warnings for high risk situations
(pass) finance.logic > applySeniorLogic > includes derivatives in analysis when provided
(pass) finance.logic > evaluateWalls > detects buy walls correctly [6.00ms]
(pass) finance.logic > evaluateWalls > detects sell walls correctly [1.00ms]
(pass) finance.logic > analyzeFunding > identifies funding rate extremes
(pass) symbol normalization > converts BTC to BTCUSDT
(pass) symbol normalization > converts BTC-USD to BTCUSDT
(pass) symbol normalization > keeps BTCUSDT unchanged
(pass) symbol normalization > handles other crypto symbols
✓ Binance Spot API: OK
(pass) finance.api.connectivity > Binance Spot API is accessible
✓ Binance Futures API: OK
(pass) finance.api.connectivity > Binance Futures API is accessible
✓ Yahoo Finance API: OK
(pass) finance.api.connectivity > Yahoo Finance API is accessible
✓ CoinGecko API: OK
(pass) finance.api.connectivity > CoinGecko API is accessible [1.00ms]
✓ Fear & Greed API: OK
(pass) finance.api.connectivity > Fear & Greed Index API is accessible
✓ BTC Price: $87,424.35
(pass) finance.api.data > can fetch BTC price from Binance
✓ ETH Price: $2,858.35
(pass) finance.api.data > can fetch ETH price from Binance
✓ AAPL Currency: USD
(pass) finance.api.data > can fetch AAPL data from Yahoo Finance
✓ Fear & Greed: 25 (Extreme Fear)
(pass) finance.api.data > can fetch current Fear & Greed value

test/tool/write.test.ts:
(pass) tool.write > write new file [25.00ms]
(pass) tool.write > overwrite existing file [19.00ms]
(pass) tool.write > write empty file [23.00ms]
(pass) tool.write > write creates parent directories [16.00ms]
(pass) tool.write > write with relative path normalizes to absolute [17.00ms]
(pass) tool.write permissions > asks for edit permission with correct pattern [17.00ms]
(pass) tool.write permissions > asks for external_directory permission for files outside project [14.00ms]
(pass) tool.write special content > write unicode content [14.00ms]
(pass) tool.write special content > write multiline content [15.00ms]
(pass) tool.write special content > write code content [27.00ms]

test/tool/grep.test.ts:
136 |       const version = "14.1.1"
137 |       const filename = `ripgrep-${version}-${config.platform}.${config.extension}`
138 |       const url = `https://github.com/BurntSushi/ripgrep/releases/download/${version}/${filename}`
139 | 
140 |       const response = await fetch(url)
141 |       if (!response.ok) throw new DownloadFailedError({ url, status: response.status })
                                    ^
RipgrepDownloadFailedError: RipgrepDownloadFailedError
 data: {
  url: "https://github.com/BurntSushi/ripgrep/releases/download/14.1.1/ripgrep-14.1.1-x86_64-unknown-linux-musl.tar.gz",
  status: 404,
},

      at <anonymous> (/media/atom13/d1af25b4-e9fd-4312-a7a2-556455554e27/AtomCLI/AtomBase/src/file/ripgrep.ts:141:31)
(fail) tool.grep > basic search [6.00ms]
136 |       const version = "14.1.1"
137 |       const filename = `ripgrep-${version}-${config.platform}.${config.extension}`
138 |       const url = `https://github.com/BurntSushi/ripgrep/releases/download/${version}/${filename}`
139 | 
140 |       const response = await fetch(url)
141 |       if (!response.ok) throw new DownloadFailedError({ url, status: response.status })
                                    ^
RipgrepDownloadFailedError: RipgrepDownloadFailedError
 data: {
  url: "https://github.com/BurntSushi/ripgrep/releases/download/14.1.1/ripgrep-14.1.1-x86_64-unknown-linux-musl.tar.gz",
  status: 404,
},

      at <anonymous> (/media/atom13/d1af25b4-e9fd-4312-a7a2-556455554e27/AtomCLI/AtomBase/src/file/ripgrep.ts:141:31)
(fail) tool.grep > no matches returns correct output [1.00ms]
136 |       const version = "14.1.1"
137 |       const filename = `ripgrep-${version}-${config.platform}.${config.extension}`
138 |       const url = `https://github.com/BurntSushi/ripgrep/releases/download/${version}/${filename}`
139 | 
140 |       const response = await fetch(url)
141 |       if (!response.ok) throw new DownloadFailedError({ url, status: response.status })
                                    ^
RipgrepDownloadFailedError: RipgrepDownloadFailedError
 data: {
  url: "https://github.com/BurntSushi/ripgrep/releases/download/14.1.1/ripgrep-14.1.1-x86_64-unknown-linux-musl.tar.gz",
  status: 404,
},

      at <anonymous> (/media/atom13/d1af25b4-e9fd-4312-a7a2-556455554e27/AtomCLI/AtomBase/src/file/ripgrep.ts:141:31)
(fail) tool.grep > handles CRLF line endings in output [1.00ms]
(pass) CRLF regex handling > regex correctly splits Unix line endings
(pass) CRLF regex handling > regex correctly splits Windows CRLF line endings
(pass) CRLF regex handling > regex handles mixed line endings [1.00ms]

test/tool/webfetch.test.ts:
(pass) tool.webfetch validation > rejects non-http URL [14.00ms]
(pass) tool.webfetch validation > rejects file:// URL [16.00ms]
(pass) tool.webfetch validation > rejects relative URL [12.00ms]
(pass) tool.webfetch permissions > asks for webfetch permission with correct pattern [13.00ms]
(pass) tool.webfetch permissions > includes timeout in permission metadata [12.00ms]
(pass) tool.webfetch format options > default format is markdown [15.00ms]
203 |                         },
204 |                         ctx,
205 |                     )
206 | 
207 |                     expect(result.output).toContain("Example Domain")
208 |                     expect((result.metadata as any).url).toBe("https://example.com")
                                                               ^
error: expect(received).toBe(expected)

Expected: "https://example.com"
Received: undefined

      at <anonymous> (/media/atom13/d1af25b4-e9fd-4312-a7a2-556455554e27/AtomCLI/AtomBase/test/tool/webfetch.test.ts:208:58)
(fail) tool.webfetch integration > fetch example.com as markdown [13.00ms]
(pass) tool.webfetch integration > fetch example.com as text [14.00ms]
(pass) tool.webfetch integration > fetch example.com as html [15.00ms]
(pass) tool.webfetch integration > handles 404 error [9.00ms]

test/tool/external-directory.test.ts:
(pass) tool.assertExternalDirectory > no-ops for empty target [1.00ms]
(pass) tool.assertExternalDirectory > no-ops for paths inside Instance.directory
(pass) tool.assertExternalDirectory > asks with a single canonical glob [1.00ms]
(pass) tool.assertExternalDirectory > uses target directory when kind=directory
(pass) tool.assertExternalDirectory > skips prompting when bypass=true

test/tool/bash.test.ts:
(pass) tool.bash > basic [44.00ms]
(pass) tool.bash permissions > asks for bash permission with correct pattern [75.00ms]
(pass) tool.bash permissions > asks for bash permission with multiple commands [71.00ms]
(pass) tool.bash permissions > asks for external_directory permission when cd to parent [39.00ms]
(pass) tool.bash permissions > asks for external_directory permission when workdir is outside project [26.00ms]
(pass) tool.bash permissions > does not ask for external_directory permission when rm inside project [24.00ms]
(pass) tool.bash permissions > includes always patterns for auto-approval [17.00ms]
(pass) tool.bash permissions > does not ask for bash permission when command is cd only [16.00ms]
(pass) tool.bash truncation > truncates output exceeding line limit [3.00ms]
(pass) tool.bash truncation > truncates output exceeding byte limit [4.00ms]
(pass) tool.bash truncation > does not truncate small output [3.00ms]
(pass) tool.bash truncation > full output is saved to file when truncated [6.00ms]

test/tool/read.test.ts:
(pass) tool.read external_directory permission > allows reading absolute path inside project directory [10.00ms]
(pass) tool.read external_directory permission > allows reading file in subdirectory inside project directory [11.00ms]
(pass) tool.read external_directory permission > asks for external_directory permission when reading absolute path outside project [20.00ms]
(pass) tool.read external_directory permission > asks for external_directory permission when reading relative path outside project [15.00ms]
(pass) tool.read external_directory permission > does not ask for external_directory permission when reading inside project [15.00ms]
(pass) tool.read env file blocking > agent=build > .env blocked=%s [4.00ms]
(pass) tool.read env file blocking > agent=build > .env.local blocked=%s [5.00ms]
(pass) tool.read env file blocking > agent=build > .env.production blocked=%s [8.00ms]
(pass) tool.read env file blocking > agent=build > .env.development.local blocked=%s [3.00ms]
(pass) tool.read env file blocking > agent=build > .env.example blocked=%s [4.00ms]
(pass) tool.read env file blocking > agent=build > .envrc blocked=%s [3.00ms]
(pass) tool.read env file blocking > agent=build > environment.ts blocked=%s [9.00ms]
(pass) tool.read env file blocking > agent=plan > .env blocked=%s [4.00ms]
(pass) tool.read env file blocking > agent=plan > .env.local blocked=%s [7.00ms]
(pass) tool.read env file blocking > agent=plan > .env.production blocked=%s [2.00ms]
(pass) tool.read env file blocking > agent=plan > .env.development.local blocked=%s [4.00ms]
(pass) tool.read env file blocking > agent=plan > .env.example blocked=%s [9.00ms]
(pass) tool.read env file blocking > agent=plan > .envrc blocked=%s [4.00ms]
(pass) tool.read env file blocking > agent=plan > environment.ts blocked=%s [3.00ms]
(pass) tool.read truncation > truncates large file by bytes and sets truncated metadata [14.00ms]
(pass) tool.read truncation > truncates by line count when limit is specified [5.00ms]
(pass) tool.read truncation > does not truncate small file [6.00ms]
(pass) tool.read truncation > respects offset parameter [2.00ms]
(pass) tool.read truncation > truncates long lines [5.00ms]
(pass) tool.read truncation > image files set truncated to false [11.00ms]
(pass) tool.read truncation > large image files are properly attached without error [12.00ms]

test/tool/patch.test.ts:
(pass) tool.patch > should validate required parameters [2.00ms]
(pass) tool.patch > should validate patch format [1.00ms]
(pass) tool.patch > should handle empty patch [1.00ms]
EACCES: permission denied, open '/etc/passwd'
    path: "/etc/passwd",
 syscall: "open",
   errno: -13,
    code: "EACCES"

(fail) tool.patch > should ask permission for files outside working directory [1.00ms]
(pass) tool.patch > should handle simple add file operation [2.00ms]
(pass) tool.patch > should handle file with context update [3.00ms]
(pass) tool.patch > should handle multiple file operations [2.00ms]
(pass) tool.patch > should create parent directories when adding nested files [1.00ms]
(pass) tool.patch > should generate proper unified diff in metadata [1.00ms]
(pass) tool.patch > should handle complex patch with multiple operations [3.00ms]

5 tests failed:
(fail) tool.grep > basic search [6.00ms]
(fail) tool.grep > no matches returns correct output [1.00ms]
(fail) tool.grep > handles CRLF line endings in output [1.00ms]
(fail) tool.webfetch integration > fetch example.com as markdown [13.00ms]
(fail) tool.patch > should ask permission for files outside working directory [1.00ms]
----------------------------------------------------------------------------------------|---------|---------|-------------------
File                                                                                    | % Funcs | % Lines | Uncovered Line #s
----------------------------------------------------------------------------------------|---------|---------|-------------------
All files                                                                               |   33.21 |   51.28 |
 src/agent/agent.ts                                                                     |   70.00 |   75.99 | 202-226,250-255,259,263-297
 src/auth/index.ts                                                                      |   50.00 |   73.21 | 40-41,49-52,59-62,66-70
 src/bun/index.ts                                                                       |   80.00 |   45.83 | 63-127
 src/bus/bus-event.ts                                                                   |  100.00 |  100.00 | 
 src/bus/global.ts                                                                      |  100.00 |  100.00 | 
 src/bus/index.ts                                                                       |   44.44 |   54.12 | 26-36,56,66-69,73-81,85,89-101
 src/cli/cmd/tui/event.ts                                                               |  100.00 |  100.00 | 
 src/command/index.ts                                                                   |   20.00 |   36.84 | 43-49,58-120,124
 src/config/config.ts                                                                   |   69.44 |   73.35 | 30,33,45-53,55-61,69-70,77,83-84,110-111,116-118,120-123,138-143,147,152-161,168,175,178,221-222,224-233,235-245,260-261,264-269,272-276,278-288,302-303,305-317,332,347-354,379-383,472-475,479-487,562-602,993-1001,1088-1093,1107,1113-1199,1232-1235
 src/config/markdown.ts                                                                 |   20.00 |   45.95 | 9,13,17-29,34-38
 src/env/index.ts                                                                       |   16.67 |   46.67 | 4,8-9,13,17-18,22-23
 src/file/ignore.ts                                                                     |   66.67 |   69.57 | 60-80
 src/file/index.ts                                                                      |   12.50 |   20.52 | 76-109,122-197,201,205-271,275-318,322-368,372-408
 src/file/ripgrep.ts                                                                    |   62.50 |   33.77 | 143-147,149-150,152-174,176-181,183-196,198-199,208-270,275-373,377-413
 src/file/time.ts                                                                       |   90.91 |   93.48 | 59-61
 src/file/watcher.ts                                                                    |   20.00 |   30.39 | 35-38,43-103,106-107,112-115
 src/flag/flag.ts                                                                       |  100.00 |   97.78 | 
 src/format/formatter.ts                                                                |    0.00 |   60.20 | 18-19,27-28,66-73,84-92,130-138,146-147,155-157,165-166,174-196,204-222,231-238,246-247,255-256,264-265,273-274,282-285,293-294,302-303,311-312,320-321,329-330,338-345,353-356
 src/format/index.ts                                                                    |   16.67 |   20.49 | 26-62,66-72,76-85,89-99,103-134
 src/global/index.ts                                                                    |   75.00 |  100.00 | 
 src/id/id.ts                                                                           |   87.50 |   91.23 | 30,37,39-41
 src/installation/index.ts                                                              |   37.50 |   28.25 | 45-48,60-102,113-117,121-160,168-202
 src/lsp/client.ts                                                                      |   50.00 |   12.97 | 42-249
 src/lsp/index.ts                                                                       |   44.44 |   49.75 | 67-70,86-92,102-123,125,141,146,162-173,189-191,196,198-205,207,209-212,214-218,220,233-234,239-242,257-258,264-273,281-283,286,294-298,303-315,359-367,371-382,386-393,397-405,409-416,420-427,431-440,444-453,463-465,470-481
 src/lsp/language.ts                                                                    |  100.00 |  100.00 | 
 src/lsp/server.ts                                                                      |   31.15 |   17.33 | 16-19,74-84,100-113,121-162,174-180,182-183,185-188,190-192,194-195,197-202,204-206,208-209,211-217,219-220,266-275,284-288,340-342,344-350,352-353,360-362,365-395,403-436,452-500,508-554,562-616,624-728,736-768,776-808,816-842,849-875,878-888,896-1034,1042-1074,1082-1125,1133-1212,1220-1303,1311-1351,1367-1491,1499-1535,1543-1553,1561-1571,1579-1589,1596-1627,1635-1717,1725-1807,1815-1846,1854-1864,1872-1885,1893-1916,1924-2010,2018-2028
 src/mcp/auth.ts                                                                        |    7.14 |   40.86 | 34-35,43-52,56-57,61-68,72-76,80-82,86-88,92-94,98-102,106-108,112-113,117-121,129-132
 src/mcp/index.ts                                                                       |    3.85 |    4.95 | 29-475,479-490,494,498-526,530-538,542-571,575-592,596-613,617-641,645-668,676-744,753-785,792-828,836-840,847-851,858-859,868-871
 src/mcp/oauth-callback.ts                                                              |   12.50 |    8.23 | 26-41,57-148,152-157,161-179,183-193
 src/mcp/oauth-provider.ts                                                              |    0.00 |    6.11 | 27-149
 src/patch/index.ts                                                                     |   75.00 |   46.61 | 86-87,97-98,102,126-128,153,202-203,215-219,229,238-290,305,313,346-350,355-360,370-374,380,419-420,426-427,460-512,517-518,523-618
 src/permission/arity.ts                                                                |  100.00 |  100.00 | 
 src/permission/next.ts                                                                 |   53.33 |   49.33 | 97-112,120-143,154-215,231-239,245,252
 src/plugin/codex.ts                                                                    |    0.00 |    4.17 | 18-23,27-31,35-37,41,54-59,64-67,72-81,85-97,108-122,126-138,184-226,242-309,313-317,321-344,348-522
 src/plugin/index.ts                                                                    |   20.00 |   16.35 | 20-77,81-94,98,102-115
 src/project/bootstrap.ts                                                               |    0.00 |   46.43 | 15-29
 src/project/instance.ts                                                                |   80.00 |   56.72 | 44-46,50-75
 src/project/project.ts                                                                 |   55.17 |   63.33 | 66-71,91-96,108-113,125-130,143,148-153,214-239,250,252-260,262,267-269,273-274,284-301,306-313
 src/project/state.ts                                                                   |   75.00 |   39.62 | 31-62
 src/project/vcs.ts                                                                     |   16.67 |   50.00 | 31-37,42-61,64,69
 src/provider/antigravity/constants.ts                                                  |    0.00 |   93.48 | 90-92
 src/provider/antigravity/index.ts                                                      |    0.00 |   11.11 | 28-56,63,70-77,84-114,123-133,140-147
 src/provider/antigravity/oauth.ts                                                      |    0.00 |    3.59 | 45-47,51,55-62,69-86,93-116,124-179,187-226,234-271
 src/provider/antigravity/storage.ts                                                    |    0.00 |   12.20 | 26-27,31-39,44-51,55-87,91-97,101-109,113-116
 src/provider/auth.ts                                                                   |   16.67 |   46.83 | 11-17,31-39,59-69,80-115,125-128
 src/provider/models.ts                                                                 |   25.00 |   76.60 | 78-83,87-102
 src/provider/ollama.ts                                                                 |    0.00 |    3.91 | 32-39,46-74,141-154,158-163,167-193,200-238
 src/provider/provider.ts                                                               |    3.23 |   16.68 | 84-123,127-143,146-152,155-164,167-176,179-189,192-205,208-338,341-349,352-360,363-377,380-394,397-416,419-427,430-466,469-476,566-628,632-639,643-960,964,968-1048,1053,1057-1073,1077-1099,1104-1115,1119-1157,1162-1167,1171-1183,1187-1191
 src/provider/sdk/openai-compatible/src/index.ts                                        |  100.00 |  100.00 | 
 src/provider/sdk/openai-compatible/src/openai-compatible-provider.ts                   |   16.67 |   61.11 | 56,68-73,77-82
 src/provider/sdk/openai-compatible/src/responses/convert-to-openai-responses-input.ts  |    0.00 |    3.50 | 16-17,21-294
 src/provider/sdk/openai-compatible/src/responses/map-openai-responses-finish-reason.ts |    0.00 |    0.00 | 3-19
 src/provider/sdk/openai-compatible/src/responses/openai-error.ts                       |    0.00 |  100.00 | 
 src/provider/sdk/openai-compatible/src/responses/openai-responses-language-model.ts    |    0.00 |   21.02 | 138-139,146-1295,1517-1519,1523-1525,1529-1533,1537-1539,1543-1545,1549-1551,1554-1556,1560-1562,1566-1568,1572-1574,1578-1582,1586-1588,1592-1594,1598-1600,1604,1616-1667
 src/provider/sdk/openai-compatible/src/responses/openai-responses-prepare-tools.ts     |    0.00 |    3.57 | 13-174
 src/provider/sdk/openai-compatible/src/responses/tool/code-interpreter.ts              |    0.00 |   91.89 | 84-86
 src/provider/sdk/openai-compatible/src/responses/tool/file-search.ts                   |    0.00 |  100.00 | 
 src/provider/sdk/openai-compatible/src/responses/tool/image-generation.ts              |    0.00 |   91.43 | 111-113
 src/provider/sdk/openai-compatible/src/responses/tool/local-shell.ts                   |  100.00 |  100.00 | 
 src/provider/sdk/openai-compatible/src/responses/tool/web-search-preview.ts            |  100.00 |  100.00 | 
 src/provider/sdk/openai-compatible/src/responses/tool/web-search.ts                    |    0.00 |   93.62 | 99-101
 src/provider/transform.ts                                                              |    6.25 |    3.25 | 10-14,19-137,141-179,183-217,221-232,236-247,251-257,261-267,274-433,437-491,495-514,518-549,554-575,579-639,643-651
 src/pty/index.ts                                                                       |    8.33 |    4.93 | 15-226
 src/question/index.ts                                                                  |   14.29 |   51.72 | 81-92,96-118,122-138,142-157,162
 src/server/error.ts                                                                    |  100.00 |  100.00 | 
 src/server/mdns.ts                                                                     |   33.33 |   16.33 | 10-39,44-54
 src/server/project.ts                                                                  |    0.00 |   90.28 | 27-28,49,73-76
 src/server/question.ts                                                                 |    0.00 |   86.36 | 26-27,56-62,90-92
 src/server/routes/agent.ts                                                             |    0.00 |   92.00 | 24-25
 src/server/routes/auth.ts                                                              |    0.00 |   88.89 | 33-36
 src/server/routes/command.ts                                                           |    0.00 |   91.67 | 23-24
 src/server/routes/config.ts                                                            |    0.00 |   87.65 | 31,54-56,82-87
 src/server/routes/file.ts                                                              |    0.00 |   89.87 | 30-32,59-61,82-83
 src/server/routes/find.ts                                                              |    0.00 |   77.57 | 33-39,69-79,106-111
 src/server/routes/global.ts                                                            |    0.00 |   68.63 | 31,57-81,102-107
 src/server/routes/instance.ts                                                          |    0.00 |   86.57 | 30-31,54-56,77-78,112-118,140-143
 src/server/routes/mcp.ts                                                               |    0.00 |   80.45 | 39-41,59-63,79-82,97-101,116-118,130-132,144-146
 src/server/routes/permission.ts                                                        |    0.00 |   82.98 | 35-40,69-76,97-98
 src/server/routes/provider.ts                                                          |    0.00 |   69.70 | 35-68,89,123-129,164-171
 src/server/routes/pty.ts                                                               |    0.00 |   83.23 | 27,50-51,74-78,102-103,126-127,151-164
 src/server/routes/session/core.ts                                                      |    0.00 |   85.91 | 39-48,70-71,100-102,131-133,161-163,186-188,216-218,257-267,297-300,328-331,359-360,388-391
 src/server/routes/session/index.ts                                                     |  100.00 |  100.00 | 
 src/server/routes/session/message.ts                                                   |    0.00 |   79.02 | 41-46,80-85,114-120,150-162,196-203,228-234
 src/server/routes/session/tool.ts                                                      |    0.00 |   81.82 | 44-50,86-109,137-138,172-175,204-207,236-239,267-269,297-300
 src/server/routes/system.ts                                                            |    0.00 |   53.64 | 43-61,82-113
 src/server/routes/tool.ts                                                              |    0.00 |   85.71 | 29,71-80
 src/server/server.ts                                                                   |   20.00 |   22.27 | 47,58-176,181-192,196-234
 src/server/tui.ts                                                                      |   12.50 |   79.46 | 20-25,47-48,70-72,97-100,123-140,162-163,200-202
 src/session/compaction.ts                                                              |   20.00 |   20.67 | 30-37,49-88,92-191,205-221
 src/session/index.ts                                                                   |    4.00 |    2.36 | 1-448,454,466-472
 src/session/llm.ts                                                                     |   33.33 |    9.36 | 46-222,226-232
 src/session/message-v2.ts                                                              |   14.29 |   62.30 | 429-550,554-560,564-570,579-582,587-600,604-679
 src/session/processor.ts                                                               |   50.00 |    4.48 | 20-403
 src/session/prompt.ts                                                                  |    6.25 |    9.88 | 57-67,70-75,80-81,151-178,182-241,245-252,256-266,270-644,648-651,655-814,818-1225,1229-1253,1269-1484,1521-1633,1637-1705
 src/session/prompt/builder.ts                                                          |    0.00 |   50.50 | 40-46,97-112,119-120,127,134,141-163
 src/session/retry.ts                                                                   |   25.00 |    4.76 | 5-56,60-87
 src/session/revert.ts                                                                  |   25.00 |   20.41 | 22-63,67-75,79-105
 src/session/status.ts                                                                  |   20.00 |   67.74 | 44-45,49-52,57,61-73
 src/session/summary.ts                                                                 |   16.67 |   17.61 | 28-32,37-60,64-153,162,167-191
 src/session/system.ts                                                                  |   16.67 |   15.00 | 23-24,28,32-37,41-143,158,161-217
 src/session/todo.ts                                                                    |   33.33 |   82.76 | 27-28,32-34
 src/share/share-next.ts                                                                |   12.50 |   11.61 | 14,18-61,65-77,81-85,112-143,147-159,163-191
 src/share/share.ts                                                                     |   20.00 |   21.33 | 13-44,48-64,72-77,81-84
 src/shell/shell.ts                                                                     |   40.00 |   24.56 | 9-32,38-52,56-58
 src/skill/index.ts                                                                     |  100.00 |  100.00 | 
 src/skill/skill.ts                                                                     |   25.00 |   27.08 | 43-145,149
 src/snapshot/index.ts                                                                  |   12.50 |   17.78 | 13-37,47-70,74-89,93-121,125-143,159-191,195-196
 src/storage/storage.ts                                                                 |   78.13 |   43.72 | 31-34,36-56,58-60,62-73,75-98,100-117,125-138,160-164,178-186,205-206
 src/tool/bash.ts                                                                       |   75.00 |   92.02 | 28,80,85,104-105,198-199,202-203,209-210,226-228,236,240
 src/tool/batch.ts                                                                      |    0.00 |    3.49 | 8-173
 src/tool/chainupdate.ts                                                                |    0.00 |   23.74 | 61-166
 src/tool/codesearch.ts                                                                 |    0.00 |   25.71 | 51-128
 src/tool/edit.ts                                                                       |   89.47 |   55.62 | 36,129-132,156-170,183,196,200-203,205-211,213,224,226-228,230-232,235-239,242-248,251-253,256-258,260-261,263-272,275-279,281,284-299,302-303,305-307,309-310,312-324,326,329-333,336-349,362,388-393,420,427-447,469,494,497-499,502-503,505-506,508-510,519,522-524,526,529-530,533-534,537-538,540-541,545-547,549-551,553-559,561-568,592-601,603,610
 src/tool/external-directory.ts                                                         |  100.00 |  100.00 | 
 src/tool/finance/index.ts                                                              |    0.00 |   15.65 | 49-160,187-237,242-261,266-303
 src/tool/finance/logic.ts                                                              |   81.82 |   59.62 | 37-41,43-47,67,69-71,88-92,96-99,103-106,110-113,154,156,165,168,189-227,265-267,295,297,302,304,313,315
 src/tool/finance/providers/crypto.ts                                                   |    0.00 |    5.56 | 40-52,62-75,83-107,119-142,149-170,177-217,225-259,266-309,320-332,339-347,354-369,380-412
 src/tool/finance/providers/yahoo.ts                                                    |    0.00 |   21.79 | 24-29,37-55,68-102,116-156,167-186,197-213,240
 src/tool/finance/symbols.ts                                                            |  100.00 |   93.43 | 326-334,336,384-388,412-418
 src/tool/finance/technical.ts                                                          |  100.00 |   96.97 | 72,179,191,210,213
 src/tool/finance/types.ts                                                              |  100.00 |  100.00 | 
 src/tool/glob.ts                                                                       |    0.00 |   25.33 | 19-74
 src/tool/grep.ts                                                                       |   50.00 |   32.43 | 21,42-44,46-49,51-53,55-61,63-65,68-69,71-72,74-75,77-78,80-82,84-90,92,94-96,98-104,106,108-120,122-125,127-133
 src/tool/invalid.ts                                                                    |    0.00 |   60.00 | 9-14
 src/tool/ls.ts                                                                         |    0.00 |   35.04 | 43-118
 src/tool/lsp.ts                                                                        |    0.00 |   31.18 | 30-93
 src/tool/mcpadd.ts                                                                     |   50.00 |   41.22 | 65-151
 src/tool/patch.ts                                                                      |   83.33 |   80.82 | 76,88,108,110-112,114-119,121,156-157,159-162,164,166-169,171-173
 src/tool/question.ts                                                                   |    0.00 |   32.26 | 10-30
 src/tool/read.ts                                                                       |   87.50 |   82.35 | 56,149-176
 src/tool/registry.ts                                                                   |   14.29 |   27.27 | 36-61,65-80,84-90,94-120,124,128-146
 src/tool/skill.ts                                                                      |    0.00 |   13.89 | 12-73
 src/tool/skilladd.ts                                                                   |    0.00 |   28.26 | 27-92
 src/tool/task.ts                                                                       |    0.00 |   11.80 | 23-179
 src/tool/todo.ts                                                                       |    0.00 |   28.57 | 10-28,35-50
 src/tool/tool.ts                                                                       |  100.00 |   82.05 | 59-65
 src/tool/truncation.ts                                                                 |   87.50 |   97.22 | 71-72
 src/tool/webfetch.ts                                                                   |   40.00 |   62.00 | 55,78,83,95-100,110-115,131-134,140-168,172-180
 src/tool/websearch.ts                                                                  |   66.67 |   85.29 | 108-109,125-127,129-135,137-139
 src/tool/write.ts                                                                      |   66.67 |   83.33 | 56-67
 src/util/archive.ts                                                                    |   50.00 |   33.33 | 5-12
 src/util/context.ts                                                                    |   66.67 |    9.09 | 1-20
 src/util/defer.ts                                                                      |    0.00 |    0.00 | 1-10
 src/util/filesystem.ts                                                                 |   63.64 |   55.38 | 13-15,19-21,58-80
 src/util/fn.ts                                                                         |   33.33 |   71.43 | 4-5
 src/util/iife.ts                                                                       |  100.00 |  100.00 | 
 src/util/lazy.ts                                                                       |   66.67 |   83.33 | 12-13
 src/util/lock.ts                                                                       |   84.62 |   68.66 | 30-32,37-38,59-66,85-92
 src/util/log.ts                                                                        |   62.50 |   74.19 | 50,53-54,86,90-93,128-130,143-145,148-149,152,155-169
 src/util/queue.ts                                                                      |    0.00 |   21.43 | 5-16,21-30
 src/util/timeout.ts                                                                    |    0.00 |    0.00 | 1-12
 src/util/token.ts                                                                      |   50.00 |   40.00 | 1-4
 src/util/wildcard.ts                                                                   |   40.00 |   35.56 | 17-25,29-39,43-51
 src/worktree/index.ts                                                                  |   10.00 |   66.85 | 130,134-139,143,147-150,154-155,159,163-177,181-184,188-214
 test/fixture/fixture.ts                                                                |  100.00 |   77.42 | 26-32
 test/preload.ts                                                                        |  100.00 |  100.00 | 
 ../libs/sdk/js/src/client.ts                                                           |    0.00 |   16.00 | 8-28
 ../libs/sdk/js/src/gen/client.gen.ts                                                   |  100.00 |  100.00 | 
 ../libs/sdk/js/src/gen/client/client.gen.ts                                            |   25.00 |   15.93 | 25-26,32-62,66-177,183-190
 ../libs/sdk/js/src/gen/client/index.ts                                                 |  100.00 |  100.00 | 
 ../libs/sdk/js/src/gen/client/utils.gen.ts                                             |   35.29 |   34.84 | 11-50,59-87,91-102,106-140,144-152,209,213-216,220-221,225-228,232-237,242-243
 ../libs/sdk/js/src/gen/core/auth.gen.ts                                                |    0.00 |    5.26 | 22-39
 ../libs/sdk/js/src/gen/core/bodySerializer.gen.ts                                      |    0.00 |   22.00 | 15-20,25-28,34-47,53,58-71
 ../libs/sdk/js/src/gen/core/params.gen.ts                                              |    0.00 |   11.11 | 50-67,78-82,86-142
 ../libs/sdk/js/src/gen/core/pathSerializer.gen.ts                                      |    0.00 |    4.76 | 28-36,41-49,54-62,67-105,109-119,123-165
 ../libs/sdk/js/src/gen/core/serverSentEvents.gen.ts                                    |    0.00 |    0.69 | 66-208
 ../libs/sdk/js/src/gen/core/utils.gen.ts                                               |    0.00 |    4.40 | 18-79,83-107
 ../libs/sdk/js/src/gen/sdk.gen.ts                                                      |    0.00 |   25.90 | 223,226-228,237-240,249-252,259-262,271-274,281-288,295-298,305-308,315-322,329-332,341-344,351-358,365-368,377-380,387-390,399-402,411-414,423-426,435-438,445-452,459-462,469-472,479-482,489-496,503-506,513-516,523-530,537-544,551-554,561-564,571-574,581-584,591-598,605-608,615-622,629-632,639-646,653-660,667-674,681-688,695-698,707-710,719-730,737-748,757-760,767-770,780-783,790-793,800-803,812-815,822-825,832-835,844-851,858-861,870-873,880-883,890-897,904-909,916-923,932-935,942-949,956-959,966-969,980-983,992-995,1004-1007,1014-1021,1030-1037,1044-1047,1054-1057,1064-1067,1074-1077,1084-1087,1094-1097,1104-1111,1118-1125,1132-1139,1149-1152,1161-1174
 ../libs/sdk/js/src/gen/types.gen.ts                                                    |  100.00 |  100.00 | 
 ../libs/sdk/js/src/index.ts                                                            |    0.00 |   25.00 | 8-19
 ../libs/sdk/js/src/server.ts                                                           |    0.00 |    2.00 | 21-89,93-121
 ../libs/util/src/error.ts                                                              |   42.86 |   80.00 | 1-2,29,33,37-40
 ../libs/util/src/fn.ts                                                                 |   33.33 |   71.43 | 4-5
 ../libs/util/src/lazy.ts                                                               |   50.00 |   37.50 | 5-9
----------------------------------------------------------------------------------------|---------|---------|-------------------

 137 pass
 5 fail
 311 expect() calls
Ran 142 tests across 11 files. [2.41s]
