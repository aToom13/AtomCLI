bun test v1.3.6 (d530ed99)

test/keybind.test.ts:
(pass) Keybind.toString > should convert simple key to string
(pass) Keybind.toString > should convert ctrl modifier to string
(pass) Keybind.toString > should convert leader key to string
(pass) Keybind.toString > should convert multiple modifiers to string
(pass) Keybind.toString > should convert all modifiers to string
(pass) Keybind.toString > should convert shift modifier to string
(pass) Keybind.toString > should convert function key to string
(pass) Keybind.toString > should convert special key to string
(pass) Keybind.toString > should handle empty name
(pass) Keybind.toString > should handle only modifiers
(pass) Keybind.toString > should handle only leader with no other parts
(pass) Keybind.toString > should convert super modifier to string
(pass) Keybind.toString > should convert super+shift modifier to string
(pass) Keybind.toString > should handle super with ctrl modifier [1.00ms]
(pass) Keybind.toString > should handle super with all modifiers
(pass) Keybind.toString > should handle undefined super field (omitted)
(pass) Keybind.match > should match identical keybinds
(pass) Keybind.match > should not match different key names
(pass) Keybind.match > should not match different modifiers
(pass) Keybind.match > should match leader keybinds
(pass) Keybind.match > should not match leader vs non-leader
(pass) Keybind.match > should match complex keybinds
(pass) Keybind.match > should not match with one modifier different
(pass) Keybind.match > should match simple key without modifiers
(pass) Keybind.match > should match super modifier keybinds
(pass) Keybind.match > should not match super vs non-super
(pass) Keybind.match > should match undefined super with false super
(pass) Keybind.match > should match super+shift combination
(pass) Keybind.match > should not match when only super differs
(pass) Keybind.parse > should parse simple key
(pass) Keybind.parse > should parse leader key syntax
(pass) Keybind.parse > should parse ctrl modifier
(pass) Keybind.parse > should parse multiple modifiers
(pass) Keybind.parse > should parse shift modifier
(pass) Keybind.parse > should parse meta/alt modifier [1.00ms]
(pass) Keybind.parse > should parse leader with modifier
(pass) Keybind.parse > should parse multiple keybinds separated by comma
(pass) Keybind.parse > should parse shift+return combination
(pass) Keybind.parse > should parse ctrl+j combination
(pass) Keybind.parse > should handle 'none' value
(pass) Keybind.parse > should handle special keys
(pass) Keybind.parse > should handle function keys
(pass) Keybind.parse > should handle complex multi-modifier combination
(pass) Keybind.parse > should be case insensitive
(pass) Keybind.parse > should parse super modifier
(pass) Keybind.parse > should parse super with shift modifier
(pass) Keybind.parse > should parse multiple keybinds with super

test/permission-task.test.ts:
(pass) PermissionNext.evaluate for permission.task > returns ask when no match (default) [1.00ms]
(pass) PermissionNext.evaluate for permission.task > returns deny for explicit deny [1.00ms]
(pass) PermissionNext.evaluate for permission.task > returns allow for explicit allow
(pass) PermissionNext.evaluate for permission.task > returns ask for explicit ask
(pass) PermissionNext.evaluate for permission.task > matches wildcard patterns with deny
(pass) PermissionNext.evaluate for permission.task > matches wildcard patterns with allow
(pass) PermissionNext.evaluate for permission.task > matches wildcard patterns with ask [1.00ms]
(pass) PermissionNext.evaluate for permission.task > later rules take precedence (last match wins) [2.00ms]
(pass) PermissionNext.evaluate for permission.task > matches global wildcard
(pass) PermissionNext.disabled for task tool > task tool is disabled when global deny pattern exists (even with specific allows)
(pass) PermissionNext.disabled for task tool > task tool is disabled when global deny pattern exists (even with ask overrides) [1.00ms]
(pass) PermissionNext.disabled for task tool > task tool is disabled when global deny pattern exists
(pass) PermissionNext.disabled for task tool > task tool is NOT disabled when only specific patterns are denied (no wildcard)
(pass) PermissionNext.disabled for task tool > task tool is enabled when no task rules exist (default ask)
(pass) PermissionNext.disabled for task tool > task tool is NOT disabled when last wildcard pattern is allow
(pass) permission.task with real config files > loads task permissions from atomcli.json config [1174.18ms]
(pass) permission.task with real config files > loads task permissions with wildcard patterns from config [17.00ms]
(pass) permission.task with real config files > evaluate respects task permission from config [14.00ms]
(pass) permission.task with real config files > mixed permission config with task and other tools [14.00ms]
(pass) permission.task with real config files > task tool disabled when global deny comes last in config [16.00ms]
(pass) permission.task with real config files > task tool NOT disabled when specific allow comes last in config [15.00ms]

test/bun.test.ts:
(pass) BunProc registry configuration > should not contain hardcoded registry parameters
(pass) BunProc registry configuration > should use Bun's default registry resolution
(pass) BunProc registry configuration > should have correct command structure without registry [1.00ms]

test/session/message-v2.test.ts:
(pass) session.message-v2.toModelMessage > filters out messages with no parts [2.00ms]
(pass) session.message-v2.toModelMessage > filters out messages with only ignored parts
(pass) session.message-v2.toModelMessage > includes synthetic text parts [2.00ms]
(pass) session.message-v2.toModelMessage > converts user text/file parts and injects compaction/subtask prompts
(pass) session.message-v2.toModelMessage > converts assistant tool completion into tool-call + tool-result messages and emits attachment message
(pass) session.message-v2.toModelMessage > replaces compacted tool output with placeholder
(pass) session.message-v2.toModelMessage > converts assistant tool error into error-text tool result [1.00ms]
(pass) session.message-v2.toModelMessage > filters assistant messages with non-abort errors
(pass) session.message-v2.toModelMessage > includes aborted assistant messages only when they have non-step-start/reasoning content
(pass) session.message-v2.toModelMessage > splits assistant messages on step-start boundaries
(pass) session.message-v2.toModelMessage > drops messages that only contain step-start parts

test/session/revert-compact.test.ts:
(pass) revert + compact workflow > should properly handle compact command after revert [67.01ms]
(pass) revert + compact workflow > should properly clean up revert state before creating compaction message [36.01ms]

test/session/session.test.ts:
(pass) session.started event > should emit session.started event when session is created [114.02ms]
(pass) session.started event > session.started event should be emitted before session.updated [104.02ms]

test/session/retry.test.ts:
(pass) session.retry.delay > caps delay at 30 seconds when headers missing
(pass) session.retry.delay > prefers retry-after-ms when shorter than exponential
(pass) session.retry.delay > uses retry-after seconds when reasonable
(pass) session.retry.delay > accepts http-date retry-after values
(pass) session.retry.delay > ignores invalid retry hints
(pass) session.retry.delay > ignores malformed date retry hints
(pass) session.retry.delay > ignores past date retry hints
(pass) session.retry.delay > uses retry-after values even when exceeding 10 minutes with headers
(pass) session.retry.delay > sleep caps delay to max 32-bit signed integer to avoid TimeoutOverflowWarning
(pass) session.message-v2.fromError > converts ECONNRESET socket errors to retryable APIError [8004.25ms]
(pass) session.message-v2.fromError > ECONNRESET socket error is retryable

test/session/compaction.test.ts:
(pass) session.compaction.isOverflow > returns true when token count exceeds usable context [3.00ms]
(pass) session.compaction.isOverflow > returns false when token count within usable context [2.00ms]
(pass) session.compaction.isOverflow > includes cache.read in token count [2.00ms]
(pass) session.compaction.isOverflow > returns false when model context limit is 0 [3.00ms]
(pass) session.compaction.isOverflow > returns false when compaction.auto is disabled [6.00ms]
(pass) util.token.estimate > estimates tokens from text (4 chars per token) [1.00ms]
(pass) util.token.estimate > estimates tokens from larger text
(pass) util.token.estimate > returns 0 for empty string
(pass) session.getUsage > normalizes standard usage to token format [2.00ms]
(pass) session.getUsage > extracts cached tokens to cache.read
(pass) session.getUsage > handles anthropic cache write metadata
(pass) session.getUsage > does not subtract cached tokens for anthropic provider
(pass) session.getUsage > handles reasoning tokens [1.00ms]
(pass) session.getUsage > handles undefined optional values gracefully
(pass) session.getUsage > calculates cost correctly

test/question/question.test.ts:
(pass) ask - returns pending promise [18.00ms]
(pass) ask - adds to pending list [14.00ms]
(pass) reply - resolves the pending ask with answers [14.00ms]
(pass) reply - removes from pending list [15.00ms]
(pass) reply - does nothing for unknown requestID [13.00ms]
(pass) reject - throws RejectedError [14.00ms]
(pass) reject - removes from pending list [12.00ms]
(pass) reject - does nothing for unknown requestID [13.00ms]
(pass) ask - handles multiple questions [11.00ms]
(pass) list - returns all pending requests [14.00ms]
(pass) list - returns empty when no pending [13.00ms]

test/mcp/headers.test.ts:
(pass) headers are passed to transports when oauth is enabled (default) [12.00ms]
(pass) headers are passed to transports when oauth is explicitly disabled [6.00ms]
(pass) no requestInit when headers are not provided [3.00ms]

test/util/lazy.test.ts:
(pass) util.lazy > should call function only once
(pass) util.lazy > should preserve the same reference
(pass) util.lazy > should work with different return types

test/util/timeout.test.ts:
(pass) util.timeout > should resolve when promise completes before timeout [13.00ms]
(pass) util.timeout > should reject when promise exceeds timeout [52.01ms]

test/util/iife.test.ts:
(pass) util.iife > should execute function immediately and return result
(pass) util.iife > should work with async functions
(pass) util.iife > should handle functions with no return value

test/util/wildcard.test.ts:
(pass) match handles glob tokens
(pass) all picks the most specific pattern
(pass) allStructured matches command sequences [1.00ms]
(pass) allStructured prioritizes flag-specific patterns
(pass) allStructured handles sed flags

test/plugin/codex.test.ts:
(pass) plugin.codex > parseJwtClaims > parses valid JWT with claims
(pass) plugin.codex > parseJwtClaims > returns undefined for JWT with less than 3 parts
(pass) plugin.codex > parseJwtClaims > returns undefined for invalid base64
(pass) plugin.codex > parseJwtClaims > returns undefined for invalid JSON payload
(pass) plugin.codex > extractAccountIdFromClaims > extracts chatgpt_account_id from root
(pass) plugin.codex > extractAccountIdFromClaims > extracts chatgpt_account_id from nested https://api.openai.com/auth
(pass) plugin.codex > extractAccountIdFromClaims > prefers root over nested
(pass) plugin.codex > extractAccountIdFromClaims > extracts from organizations array as fallback
(pass) plugin.codex > extractAccountIdFromClaims > returns undefined when no accountId found
(pass) plugin.codex > extractAccountId > extracts from id_token first [1.00ms]
(pass) plugin.codex > extractAccountId > falls back to access_token when id_token has no accountId
(pass) plugin.codex > extractAccountId > returns undefined when no tokens have accountId
(pass) plugin.codex > extractAccountId > handles missing id_token

test/permission/arity.test.ts:
(pass) arity 1 - unknown commands default to first token
(pass) arity 2 - two token commands
(pass) arity 3 - three token commands
(pass) longest match wins - nested prefixes
(pass) exact length matches
(pass) edge cases

test/permission/next.test.ts:
(pass) fromConfig - string value becomes wildcard rule
(pass) fromConfig - object value converts to rules array
(pass) fromConfig - mixed string and object values
(pass) fromConfig - empty object
(pass) merge - simple concatenation
(pass) merge - adds new permission
(pass) merge - concatenates rules for same permission
(pass) merge - multiple rulesets
(pass) merge - empty ruleset does nothing
(pass) merge - preserves rule order
(pass) merge - config permission overrides default ask
(pass) merge - config ask overrides default allow
(pass) evaluate - exact pattern match
(pass) evaluate - wildcard pattern match
(pass) evaluate - last matching rule wins
(pass) evaluate - last matching rule wins (wildcard after specific)
(pass) evaluate - glob pattern match
(pass) evaluate - last matching glob wins
(pass) evaluate - order matters for specificity [1.00ms]
(pass) evaluate - unknown permission returns ask
(pass) evaluate - empty ruleset returns ask
(pass) evaluate - no matching pattern returns ask
(pass) evaluate - empty rules array returns ask
(pass) evaluate - multiple matching patterns, last wins
(pass) evaluate - non-matching patterns are skipped
(pass) evaluate - exact match at end wins over earlier wildcard
(pass) evaluate - wildcard at end overrides earlier exact match
(pass) evaluate - wildcard permission matches any permission
(pass) evaluate - wildcard permission with specific pattern
(pass) evaluate - glob permission pattern
(pass) evaluate - specific permission and wildcard permission combined
(pass) evaluate - wildcard permission does not match when specific exists
(pass) evaluate - multiple matching permission patterns combine rules
(pass) evaluate - wildcard permission fallback for unknown tool
(pass) evaluate - permission patterns sorted by length regardless of object order
(pass) evaluate - merges multiple rulesets
(pass) disabled - returns empty set when all tools allowed
(pass) disabled - disables tool when denied
(pass) disabled - disables edit/write/patch/multiedit when edit denied [1.00ms]
(pass) disabled - does not disable when partially denied
(pass) disabled - does not disable when action is ask
(pass) disabled - does not disable when specific allow after wildcard deny
(pass) disabled - does not disable when wildcard allow after deny
(pass) disabled - disables multiple tools
(pass) disabled - wildcard permission denies all tools
(pass) disabled - specific allow overrides wildcard deny
(pass) ask - resolves immediately when action is allow [20.00ms]
(pass) ask - throws RejectedError when action is deny [14.00ms]
(pass) ask - returns pending promise when action is ask [14.00ms]
(pass) reply - once resolves the pending ask [15.00ms]
(pass) reply - reject throws RejectedError [14.00ms]
(pass) reply - always persists approval and resolves [15.00ms]
(pass) reply - reject cancels all pending for same session [14.00ms]
(pass) ask - checks all patterns and stops on first deny [11.00ms]
(pass) ask - allows all patterns when all match allow rules [15.00ms]

test/lsp/client.test.ts:
(pass) LSPClient interop > handles workspace/workspaceFolders request [378.06ms]
(pass) LSPClient interop > handles client/registerCapability request [328.05ms]
(pass) LSPClient interop > handles client/unregisterCapability request [321.05ms]

test/project/project.test.ts:
(pass) Project.fromDirectory > should handle git repository with no commits [10.00ms]
(pass) Project.fromDirectory > should handle git repository with commits [14.00ms]
(pass) Project.fromDirectory with worktrees > should set worktree to root when called from root [16.00ms]
(pass) Project.fromDirectory with worktrees > should set worktree to root when called from a worktree [29.00ms]
(pass) Project.fromDirectory with worktrees > should accumulate multiple worktrees in sandboxes [41.01ms]
(pass) Project.discover > should discover favicon.png in root [14.00ms]
(pass) Project.discover > should not discover non-image files [14.00ms]

test/agent/agent.test.ts:
(pass) returns default native agents when no config [3.00ms]
(pass) build agent has correct default properties [8.00ms]
(pass) plan agent denies edits except .atomcli/plan/* [3.00ms]
(pass) explore agent denies edit and write [3.00ms]
(pass) general agent denies todo tools [8.00ms]
(pass) compaction agent denies all permissions [5.00ms]
(pass) custom agent from config creates new agent [4.00ms]
(pass) custom agent config overrides native agent properties [4.00ms]
(pass) agent disable removes agent from list [7.00ms]
(pass) agent permission config merges with defaults [3.00ms]
(pass) global permission config applies to all agents [4.00ms]
(pass) agent steps/maxSteps config sets steps property [7.00ms]
(pass) agent mode can be overridden [3.00ms]
(pass) agent name can be overridden [3.00ms]
(pass) agent prompt can be set from config [4.00ms]
(pass) unknown agent properties are placed into options [7.00ms]
(pass) agent options merge correctly [4.00ms]
(pass) multiple custom agents can be defined [3.00ms]
(pass) Agent.get returns undefined for non-existent agent [7.00ms]
(pass) default permission includes doom_loop and external_directory as ask [3.00ms]
(pass) webfetch is allowed by default [3.00ms]
(pass) legacy tools config converts to permissions [3.00ms]
(pass) legacy tools config maps write/edit/patch/multiedit to edit permission [2.00ms]
(pass) Truncate.DIR is allowed even when user denies external_directory globally [7.00ms]
(pass) Truncate.DIR is allowed even when user denies external_directory per-agent [4.00ms]
(pass) explicit Truncate.DIR deny is respected [3.00ms]

test/tool/websearch.test.ts:
(pass) tool.websearch permissions > asks for websearch permission with correct pattern [23.00ms]
(pass) tool.websearch permissions > includes numResults in permission metadata [15.00ms]
(pass) tool.websearch permissions > includes livecrawl in permission metadata [19.00ms]
(pass) tool.websearch permissions > includes type in permission metadata [15.00ms]
(pass) tool.websearch permissions > includes contextMaxCharacters in permission metadata [17.00ms]
(pass) tool.websearch integration > basic search returns results [17.00ms]

test/tool/edit.test.ts:
(pass) tool.edit > basic edit - replace single occurrence [25.00ms]
(pass) tool.edit > edit with replaceAll=true [17.00ms]
(pass) tool.edit > edit with replaceAll=false rejects multiple matches [18.00ms]
(pass) tool.edit > edit non-existent file throws error [16.00ms]
(pass) tool.edit > edit with empty oldString creates new file [15.00ms]
(pass) tool.edit > edit with same oldString and newString throws error [13.00ms]
(pass) tool.edit > edit directory path throws error [14.00ms]
(pass) tool.edit permissions > asks for edit permission with correct pattern [16.00ms]
(pass) tool.edit permissions > asks for external_directory permission for files outside project [18.00ms]
(pass) tool.edit unicode and special characters > edit with unicode characters [17.00ms]
(pass) tool.edit unicode and special characters > edit with line endings (CRLF) [18.00ms]
(pass) tool.edit unicode and special characters > edit multiline content [20.00ms]

test/tool/truncation.test.ts:
(pass) Truncate > output > truncates large json file by bytes [6.00ms]
(pass) Truncate > output > returns content unchanged when under limits
(pass) Truncate > output > truncates by line count
(pass) Truncate > output > truncates by byte count [1.00ms]
(pass) Truncate > output > truncates from head by default
(pass) Truncate > output > truncates from tail when direction is tail
(pass) Truncate > output > uses default MAX_LINES and MAX_BYTES
(pass) Truncate > output > large single-line file truncates with byte message [2.00ms]
(pass) Truncate > output > writes full output to file when truncated
(pass) Truncate > output > suggests Task tool when agent has task permission [1.00ms]
(pass) Truncate > output > omits Task tool hint when agent lacks task permission
(pass) Truncate > output > does not write file when not truncated
(pass) Truncate > cleanup > deletes files older than 7 days and preserves recent files

test/tool/finance.test.ts:
(pass) finance.symbols > detectAssetType > detects crypto symbols correctly [1.00ms]
(pass) finance.symbols > detectAssetType > detects stock symbols correctly
(pass) finance.symbols > detectAssetType > detects forex symbols correctly
(pass) finance.symbols > detectAssetType > detects commodity symbols correctly
(pass) finance.symbols > detectAssetType > detects index symbols correctly
(pass) finance.symbols > detectAssetType > returns correct ticker format
(pass) finance.symbols > detectAssetType > respects explicit type override
(pass) finance.symbols > utility functions > getAssetTypeEmoji returns an emoji
(pass) finance.symbols > utility functions > getAssetTypeName returns Turkish name
(pass) finance.technical > analyzeKlines returns valid technical indicators [1.00ms]
(pass) finance.technical > analyzeKlines handles empty array
(pass) finance.technical > analyzeKlines handles short arrays
(pass) finance.technical > RSI calculation is correct for extreme cases [1.00ms]
(pass) finance.logic > applySeniorLogic > calculates risk score correctly
(pass) finance.logic > applySeniorLogic > generates warnings for high risk situations
(pass) finance.logic > applySeniorLogic > includes derivatives in analysis when provided
(pass) finance.logic > evaluateWalls > detects buy walls correctly [7.00ms]
(pass) finance.logic > evaluateWalls > detects sell walls correctly
(pass) finance.logic > analyzeFunding > identifies funding rate extremes
(pass) symbol normalization > converts BTC to BTCUSDT
(pass) symbol normalization > converts BTC-USD to BTCUSDT
(pass) symbol normalization > keeps BTCUSDT unchanged
(pass) symbol normalization > handles other crypto symbols
✓ Binance Spot API: OK
(pass) finance.api.connectivity > Binance Spot API is accessible
✓ Binance Futures API: OK
(pass) finance.api.connectivity > Binance Futures API is accessible
✓ Yahoo Finance API: OK
(pass) finance.api.connectivity > Yahoo Finance API is accessible
✓ CoinGecko API: OK
(pass) finance.api.connectivity > CoinGecko API is accessible
✓ Fear & Greed API: OK
(pass) finance.api.connectivity > Fear & Greed Index API is accessible [1.00ms]
✓ BTC Price: $87,424.35
(pass) finance.api.data > can fetch BTC price from Binance
✓ ETH Price: $2,858.35
(pass) finance.api.data > can fetch ETH price from Binance
✓ AAPL Currency: USD
(pass) finance.api.data > can fetch AAPL data from Yahoo Finance
✓ Fear & Greed: 25 (Extreme Fear)
(pass) finance.api.data > can fetch current Fear & Greed value

test/tool/write.test.ts:
(pass) tool.write > write new file [17.00ms]
(pass) tool.write > overwrite existing file [18.00ms]
(pass) tool.write > write empty file [16.00ms]
(pass) tool.write > write creates parent directories [15.00ms]
(pass) tool.write > write with relative path normalizes to absolute [16.00ms]
(pass) tool.write permissions > asks for edit permission with correct pattern [16.00ms]
(pass) tool.write permissions > asks for external_directory permission for files outside project [18.00ms]
(pass) tool.write special content > write unicode content [15.00ms]
(pass) tool.write special content > write multiline content [23.00ms]
(pass) tool.write special content > write code content [29.00ms]

test/tool/grep.test.ts:
(pass) tool.grep > basic search [1897.29ms]
(pass) tool.grep > no matches returns correct output [6.00ms]
(pass) tool.grep > handles CRLF line endings in output [5.00ms]
(pass) CRLF regex handling > regex correctly splits Unix line endings
(pass) CRLF regex handling > regex correctly splits Windows CRLF line endings
(pass) CRLF regex handling > regex handles mixed line endings

test/tool/webfetch.test.ts:
(pass) tool.webfetch validation > rejects non-http URL [20.00ms]
(pass) tool.webfetch validation > rejects file:// URL [12.00ms]
(pass) tool.webfetch validation > rejects relative URL [14.00ms]
(pass) tool.webfetch permissions > asks for webfetch permission with correct pattern [13.00ms]
(pass) tool.webfetch permissions > includes timeout in permission metadata [15.00ms]
(pass) tool.webfetch format options > default format is markdown [14.00ms]
(pass) tool.webfetch integration > fetch example.com as markdown [12.00ms]
(pass) tool.webfetch integration > fetch example.com as text [13.00ms]
(pass) tool.webfetch integration > fetch example.com as html [11.00ms]
(pass) tool.webfetch integration > handles 404 error [15.00ms]

test/tool/external-directory.test.ts:
(pass) tool.assertExternalDirectory > no-ops for empty target
(pass) tool.assertExternalDirectory > no-ops for paths inside Instance.directory
(pass) tool.assertExternalDirectory > asks with a single canonical glob
(pass) tool.assertExternalDirectory > uses target directory when kind=directory [1.00ms]
(pass) tool.assertExternalDirectory > skips prompting when bypass=true

test/tool/bash.test.ts:
(pass) tool.bash > basic [29.00ms]
(pass) tool.bash permissions > asks for bash permission with correct pattern [32.00ms]
(pass) tool.bash permissions > asks for bash permission with multiple commands [17.00ms]
(pass) tool.bash permissions > asks for external_directory permission when cd to parent [17.00ms]
(pass) tool.bash permissions > asks for external_directory permission when workdir is outside project [24.00ms]
(pass) tool.bash permissions > does not ask for external_directory permission when rm inside project [20.00ms]
(pass) tool.bash permissions > includes always patterns for auto-approval [17.00ms]
(pass) tool.bash permissions > does not ask for bash permission when command is cd only [18.00ms]
(pass) tool.bash truncation > truncates output exceeding line limit [5.00ms]
(pass) tool.bash truncation > truncates output exceeding byte limit [4.00ms]
(pass) tool.bash truncation > does not truncate small output [2.00ms]
(pass) tool.bash truncation > full output is saved to file when truncated [6.00ms]

test/tool/read.test.ts:
(pass) tool.read external_directory permission > allows reading absolute path inside project directory [4.00ms]
(pass) tool.read external_directory permission > allows reading file in subdirectory inside project directory [1.00ms]
(pass) tool.read external_directory permission > asks for external_directory permission when reading absolute path outside project [16.00ms]
(pass) tool.read external_directory permission > asks for external_directory permission when reading relative path outside project [16.00ms]
(pass) tool.read external_directory permission > does not ask for external_directory permission when reading inside project [15.00ms]
(pass) tool.read env file blocking > agent=build > .env blocked=%s [4.00ms]
(pass) tool.read env file blocking > agent=build > .env.local blocked=%s [3.00ms]
(pass) tool.read env file blocking > agent=build > .env.production blocked=%s [4.00ms]
(pass) tool.read env file blocking > agent=build > .env.development.local blocked=%s [8.00ms]
(pass) tool.read env file blocking > agent=build > .env.example blocked=%s [4.00ms]
(pass) tool.read env file blocking > agent=build > .envrc blocked=%s [5.00ms]
(pass) tool.read env file blocking > agent=build > environment.ts blocked=%s [3.00ms]
(pass) tool.read env file blocking > agent=plan > .env blocked=%s [5.00ms]
(pass) tool.read env file blocking > agent=plan > .env.local blocked=%s [3.00ms]
(pass) tool.read env file blocking > agent=plan > .env.production blocked=%s [2.00ms]
(pass) tool.read env file blocking > agent=plan > .env.development.local blocked=%s [3.00ms]
(pass) tool.read env file blocking > agent=plan > .env.example blocked=%s [6.00ms]
(pass) tool.read env file blocking > agent=plan > .envrc blocked=%s [3.00ms]
(pass) tool.read env file blocking > agent=plan > environment.ts blocked=%s [3.00ms]
(pass) tool.read truncation > truncates large file by bytes and sets truncated metadata [9.00ms]
(pass) tool.read truncation > truncates by line count when limit is specified [4.00ms]
(pass) tool.read truncation > does not truncate small file [3.00ms]
(pass) tool.read truncation > respects offset parameter [5.00ms]
(pass) tool.read truncation > truncates long lines [4.00ms]
(pass) tool.read truncation > image files set truncated to false [5.00ms]
(pass) tool.read truncation > large image files are properly attached without error [13.00ms]

test/tool/patch.test.ts:
(pass) tool.patch > should validate required parameters [2.00ms]
(pass) tool.patch > should validate patch format [1.00ms]
(pass) tool.patch > should handle empty patch
(pass) tool.patch > should ask permission for files outside working directory
(pass) tool.patch > should handle simple add file operation [2.00ms]
(pass) tool.patch > should handle file with context update [1.00ms]
(pass) tool.patch > should handle multiple file operations [2.00ms]
(pass) tool.patch > should create parent directories when adding nested files [1.00ms]
(pass) tool.patch > should generate proper unified diff in metadata [3.00ms]
(pass) tool.patch > should handle complex patch with multiple operations [4.00ms]

test/config/markdown.test.ts:
(pass) should extract exactly 12 file references
(pass) should extract valid/path/to/a/file
(pass) should extract another-valid/path/to/a/file
(pass) should extract paths ignoring comma after [1.00ms]
(pass) should extract a path with a file extension and comma after
(pass) should extract a path with multiple dots and comma after
(pass) should extract hidden directory
(pass) should extract hidden file
(pass) should extract a file ignoring period at end of sentence
(pass) should extract an absolute path with an extension
(pass) should extract an absolute path without an extension
(pass) should extract an absolute path in home directory
(pass) should extract an absolute path under home directory
(pass) should not match when preceded by backtick
(pass) should not match email addresses

test/config/agent-color.test.ts:
(pass) agent color parsed from project config [4.00ms]
(pass) Agent.get includes color from config [4.00ms]
(pass) Color.hexToAnsiBold converts valid hex to ANSI
(pass) Color.hexToAnsiBold returns undefined for invalid hex

test/config/config.test.ts:
(pass) loads config with defaults when no files exist [3.00ms]
(pass) loads JSON config file [5.00ms]
(pass) loads JSONC config file [7.00ms]
(pass) merges multiple config files with correct precedence [4.00ms]
(pass) handles environment variable substitution [8.00ms]
(pass) handles file inclusion substitution [7.00ms]
(pass) validates config schema and throws on invalid fields [2.00ms]
(pass) throws error for invalid JSON [3.00ms]
(pass) handles agent configuration [4.00ms]
(pass) handles command configuration [4.00ms]
(pass) migrates autoshare to share field [4.00ms]
(pass) migrates mode field to agent field [10.00ms]
(pass) loads config from .atomcli directory [181.03ms]
(pass) updates config and writes to file [1.00ms]
(pass) gets config directories [2.00ms]
(pass) resolves scoped npm plugins in config [4.00ms]
(pass) merges plugin arrays from global and local configs [150.02ms]
(pass) does not error when only custom agent is a subagent [433.07ms]
(pass) merges instructions arrays from global and local configs [185.03ms]
(pass) deduplicates duplicate instructions from global and local configs [160.02ms]
(pass) deduplicates duplicate plugins from global and local configs [141.02ms]
(pass) migrates legacy tools config to permissions - allow [2.00ms]
(pass) migrates legacy tools config to permissions - deny [3.00ms]
(pass) migrates legacy write tool to edit permission [2.00ms]
(pass) migrates legacy edit tool to edit permission [4.00ms]
(pass) migrates legacy patch tool to edit permission [3.00ms]
(pass) migrates legacy multiedit tool to edit permission [3.00ms]
(pass) migrates mixed legacy tools config [4.00ms]
(pass) merges legacy tools with existing permission config [8.00ms]
(pass) permission config preserves key order [3.00ms]
(pass) project config can override MCP server enabled status [3.00ms]
(pass) MCP config deep merges preserving base config properties [5.00ms]
(pass) local .atomcli config can override MCP from project config [221.03ms]
(pass) project config overrides remote well-known config [20.00ms]
(pass) getPluginName > extracts name from file:// URL
(pass) getPluginName > extracts name from npm package with version
(pass) getPluginName > extracts name from scoped npm package
(pass) getPluginName > returns full string for package without version
(pass) deduplicatePlugins > removes duplicates keeping higher priority (later entries)
(pass) deduplicatePlugins > prefers local file over npm package with same name
(pass) deduplicatePlugins > preserves order of remaining plugins
(pass) deduplicatePlugins > local plugin directory overrides global atomcli.json plugin [150.02ms]

test/provider/transform.test.ts:
(pass) ProviderTransform.options - setCacheKey > should set promptCacheKey when providerOptions.setCacheKey is true [1.00ms]
(pass) ProviderTransform.options - setCacheKey > should not set promptCacheKey when providerOptions.setCacheKey is false
(pass) ProviderTransform.options - setCacheKey > should not set promptCacheKey when providerOptions is undefined
(pass) ProviderTransform.options - setCacheKey > should not set promptCacheKey when providerOptions does not have setCacheKey
(pass) ProviderTransform.options - setCacheKey > should set promptCacheKey for openai provider regardless of setCacheKey
(pass) ProviderTransform.maxOutputTokens > returns 32k when modelLimit > 32k
(pass) ProviderTransform.maxOutputTokens > returns modelLimit when modelLimit < 32k
(pass) ProviderTransform.maxOutputTokens > azure > returns 32k when modelLimit > 32k
(pass) ProviderTransform.maxOutputTokens > azure > returns modelLimit when modelLimit < 32k
(pass) ProviderTransform.maxOutputTokens > bedrock > returns 32k when modelLimit > 32k
(pass) ProviderTransform.maxOutputTokens > bedrock > returns modelLimit when modelLimit < 32k
(pass) ProviderTransform.maxOutputTokens > anthropic without thinking options > returns 32k when modelLimit > 32k
(pass) ProviderTransform.maxOutputTokens > anthropic without thinking options > returns modelLimit when modelLimit < 32k
(pass) ProviderTransform.maxOutputTokens > anthropic with thinking options > returns 32k when budgetTokens + 32k <= modelLimit
(pass) ProviderTransform.maxOutputTokens > anthropic with thinking options > returns modelLimit - budgetTokens when budgetTokens + 32k > modelLimit
(pass) ProviderTransform.maxOutputTokens > anthropic with thinking options > returns 32k when thinking type is not enabled
(pass) ProviderTransform.schema - gemini array items > adds missing items for array properties
(pass) ProviderTransform.message - DeepSeek reasoning content > DeepSeek with tool calls includes reasoning_content in providerOptions
(pass) ProviderTransform.message - DeepSeek reasoning content > Non-DeepSeek providers leave reasoning content unchanged
(pass) ProviderTransform.message - empty image handling > should replace empty base64 image with error text [1.00ms]
(pass) ProviderTransform.message - empty image handling > should keep valid base64 images unchanged
(pass) ProviderTransform.message - empty image handling > should handle mixed valid and empty images
(pass) ProviderTransform.message - anthropic empty content filtering > filters out messages with empty string content
(pass) ProviderTransform.message - anthropic empty content filtering > filters out empty text parts from array content
(pass) ProviderTransform.message - anthropic empty content filtering > filters out empty reasoning parts from array content
(pass) ProviderTransform.message - anthropic empty content filtering > removes entire message when all parts are empty [1.00ms]
(pass) ProviderTransform.message - anthropic empty content filtering > keeps non-text/reasoning parts even if text parts are empty
(pass) ProviderTransform.message - anthropic empty content filtering > keeps messages with valid text alongside empty parts
(pass) ProviderTransform.message - anthropic empty content filtering > does not filter for non-anthropic providers
(pass) ProviderTransform.variants > returns empty object when model has no reasoning capabilities
(pass) ProviderTransform.variants > deepseek returns empty object
(pass) ProviderTransform.variants > minimax returns empty object
(pass) ProviderTransform.variants > glm returns empty object
(pass) ProviderTransform.variants > mistral returns empty object
(pass) ProviderTransform.variants > @openrouter/ai-sdk-provider > returns empty object for non-qualifying models
(pass) ProviderTransform.variants > @openrouter/ai-sdk-provider > gpt models return OPENAI_EFFORTS with reasoning
(pass) ProviderTransform.variants > @openrouter/ai-sdk-provider > gemini-3 returns OPENAI_EFFORTS with reasoning
(pass) ProviderTransform.variants > @openrouter/ai-sdk-provider > grok-4 returns OPENAI_EFFORTS with reasoning [1.00ms]
(pass) ProviderTransform.variants > @ai-sdk/gateway > returns OPENAI_EFFORTS with reasoningEffort
(pass) ProviderTransform.variants > @ai-sdk/cerebras > returns WIDELY_SUPPORTED_EFFORTS with reasoningEffort
(pass) ProviderTransform.variants > @ai-sdk/togetherai > returns WIDELY_SUPPORTED_EFFORTS with reasoningEffort
(pass) ProviderTransform.variants > @ai-sdk/xai > returns WIDELY_SUPPORTED_EFFORTS with reasoningEffort
(pass) ProviderTransform.variants > @ai-sdk/deepinfra > returns WIDELY_SUPPORTED_EFFORTS with reasoningEffort
(pass) ProviderTransform.variants > @ai-sdk/openai-compatible > returns WIDELY_SUPPORTED_EFFORTS with reasoningEffort
(pass) ProviderTransform.variants > @ai-sdk/azure > o1-mini returns empty object
(pass) ProviderTransform.variants > @ai-sdk/azure > standard azure models return custom efforts with reasoningSummary
(pass) ProviderTransform.variants > @ai-sdk/azure > gpt-5 adds minimal effort
(pass) ProviderTransform.variants > @ai-sdk/openai > gpt-5-pro returns empty object
(pass) ProviderTransform.variants > @ai-sdk/openai > standard openai models return custom efforts with reasoningSummary
(pass) ProviderTransform.variants > @ai-sdk/openai > models after 2025-11-13 include 'none' effort
(pass) ProviderTransform.variants > @ai-sdk/openai > models after 2025-12-04 include 'xhigh' effort
(pass) ProviderTransform.variants > @ai-sdk/anthropic > returns high and max with thinking config
(pass) ProviderTransform.variants > @ai-sdk/amazon-bedrock > returns WIDELY_SUPPORTED_EFFORTS with reasoningConfig
(pass) ProviderTransform.variants > @ai-sdk/google > gemini-2.5 returns high and max with thinkingConfig and thinkingBudget [1.00ms]
(pass) ProviderTransform.variants > @ai-sdk/google > other gemini models return low and high with thinkingLevel
(pass) ProviderTransform.variants > @ai-sdk/google-vertex > gemini-2.5 returns high and max with thinkingConfig and thinkingBudget
(pass) ProviderTransform.variants > @ai-sdk/google-vertex > other vertex models return low and high with thinkingLevel
(pass) ProviderTransform.variants > @ai-sdk/cohere > returns empty object
(pass) ProviderTransform.variants > @ai-sdk/groq > returns none and WIDELY_SUPPORTED_EFFORTS with thinkingLevel
(pass) ProviderTransform.variants > @ai-sdk/perplexity > returns empty object

test/provider/provider.test.ts:
(pass) provider loaded from env variable [546.08ms]
(pass) provider loaded from config with apiKey option [332.05ms]
(pass) disabled_providers excludes provider [350.05ms]
(pass) enabled_providers restricts to only listed providers [383.06ms]
(pass) model whitelist filters models for provider [353.05ms]
(pass) model blacklist excludes specific models [339.05ms]
(pass) custom model alias via config [543.08ms]
(pass) custom provider with npm package [318.05ms]
(pass) env variable takes precedence, config merges options [399.06ms]
(pass) getModel returns model for valid provider/model [1099.17ms]
(pass) getModel throws ModelNotFoundError for invalid model [1055.16ms]
(pass) getModel throws ModelNotFoundError for invalid provider [1359.21ms]
(pass) parseModel correctly parses provider/model string [1.00ms]
(pass) parseModel handles model IDs with slashes
(pass) defaultModel returns first available model when no config set [318.05ms]
(pass) defaultModel respects config model setting [2.00ms]
(pass) provider with baseURL from config [332.05ms]
(pass) model cost defaults to zero when not specified [333.05ms]
(pass) model options are merged from existing model [368.06ms]
(pass) provider removed when all models filtered out [309.05ms]
(pass) closest finds model by partial match [307.05ms]
(pass) closest returns undefined for nonexistent provider [292.04ms]
(pass) getModel uses realIdByKey for aliased models [336.05ms]
(pass) provider api field sets model api.url [1296.20ms]
(pass) explicit baseURL overrides api field [359.05ms]
(pass) model inherits properties from existing database model [314.05ms]
(pass) disabled_providers prevents loading even with env var [332.05ms]
(pass) enabled_providers with empty array allows no providers [350.05ms]
(pass) whitelist and blacklist can be combined [332.05ms]
(pass) model modalities default correctly [397.06ms]
(pass) model with custom cost values [310.05ms]
(pass) getSmallModel returns appropriate small model [863.13ms]
(pass) getSmallModel respects config small_model override [845.13ms]
(pass) provider.sort prioritizes preferred models
(pass) multiple providers can be configured simultaneously [367.06ms]
(pass) provider with custom npm package [347.05ms]
(pass) model alias name defaults to alias key when id differs [299.04ms]
(pass) provider with multiple env var options only includes apiKey when single env [399.06ms]
(pass) provider with single env var includes apiKey automatically [364.05ms]
(pass) model cost overrides existing cost values [362.05ms]
(pass) completely new provider not in database can be configured [469.07ms]
(pass) disabled_providers and enabled_providers interaction [372.06ms]
(pass) model with tool_call false [355.05ms]
(pass) model defaults tool_call to true when not specified [362.05ms]
(pass) model headers are preserved [370.06ms]
(pass) provider env fallback - second env var used if first missing [335.05ms]
(pass) getModel returns consistent results [308.05ms]
(pass) provider name defaults to id when not in database [321.05ms]
(pass) ModelNotFoundError includes suggestions for typos [340.05ms]
(pass) ModelNotFoundError for provider includes suggestions [329.05ms]
(pass) getProvider returns undefined for nonexistent provider [313.05ms]
(pass) getProvider returns provider info [350.05ms]
(pass) closest returns undefined when no partial match found [381.06ms]
(pass) closest checks multiple query terms in order [346.05ms]
(pass) model limit defaults to zero when not specified [416.06ms]
(pass) provider options are deeply merged [308.05ms]
(pass) custom model inherits npm package from models.dev provider config [305.05ms]
(pass) custom model inherits api.url from models.dev provider [347.05ms]
(pass) model variants are generated for reasoning models [890.13ms]
(pass) model variants can be disabled via config [493.07ms]
(pass) model variants can be customized via config [344.05ms]
(pass) disabled key is stripped from variant config [331.05ms]
(pass) all variants can be disabled via config [314.05ms]
(pass) variant config merges with generated variants [317.05ms]
(pass) variants filtered in second pass for database models [311.05ms]
(pass) custom model with variants enabled and disabled [300.04ms]

test/provider/amazon-bedrock.test.ts:
(pass) Bedrock: config region takes precedence over AWS_REGION env var [18.00ms]
(pass) Bedrock: falls back to AWS_REGION env var when no config region [17.00ms]
(pass) Bedrock: loads when bearer token from auth.json is present [19.00ms]
(pass) Bedrock: config profile takes precedence over AWS_PROFILE env var [17.00ms]
(pass) Bedrock: includes custom endpoint in options when specified [19.00ms]

test/patch/patch.test.ts:
(pass) Patch namespace > parsePatch > should parse simple add file patch [1.00ms]
(pass) Patch namespace > parsePatch > should parse delete file patch
(pass) Patch namespace > parsePatch > should parse patch with multiple hunks [1.00ms]
(pass) Patch namespace > parsePatch > should parse file move operation
(pass) Patch namespace > parsePatch > should throw error for invalid patch format
(pass) Patch namespace > maybeParseApplyPatch > should parse direct apply_patch command
(pass) Patch namespace > maybeParseApplyPatch > should parse applypatch command
(pass) Patch namespace > maybeParseApplyPatch > should handle bash heredoc format [1.00ms]
(pass) Patch namespace > maybeParseApplyPatch > should return NotApplyPatch for non-patch commands
(pass) Patch namespace > applyPatch > should add a new file
(pass) Patch namespace > applyPatch > should delete an existing file [1.00ms]
(pass) Patch namespace > applyPatch > should update an existing file
(pass) Patch namespace > applyPatch > should move and update a file [2.00ms]
(pass) Patch namespace > applyPatch > should handle multiple operations in one patch
(pass) Patch namespace > applyPatch > should create parent directories when adding files [3.00ms]
(pass) Patch namespace > error handling > should throw error when updating non-existent file [1.00ms]
(pass) Patch namespace > error handling > should throw error when deleting non-existent file
(pass) Patch namespace > edge cases > should handle empty files [1.00ms]
(pass) Patch namespace > edge cases > should handle files with no trailing newline
(pass) Patch namespace > edge cases > should handle multiple update chunks in single file [1.00ms]

test/file/ignore.test.ts:
(pass) match nested and non-nested

test/file/path-traversal.test.ts:
(pass) Filesystem.contains > allows paths within project
(pass) Filesystem.contains > blocks ../ traversal
(pass) Filesystem.contains > blocks absolute paths outside project
(pass) Filesystem.contains > handles prefix collision edge cases
(pass) File.read path traversal protection > rejects ../ traversal attempting to read /etc/passwd [2.00ms]
(pass) File.read path traversal protection > rejects deeply nested traversal [1.00ms]
(pass) File.read path traversal protection > allows valid paths within project [1.00ms]
(pass) File.list path traversal protection > rejects ../ traversal attempting to list /etc
(pass) File.list path traversal protection > allows valid subdirectory listing [1.00ms]

test/skill/skill.test.ts:
(pass) discovers skills from .atomcli/skill/ directory [24.00ms]
(pass) discovers multiple skills from .atomcli/skill/ directory [20.00ms]
(pass) skips skills with missing frontmatter [18.00ms]
(pass) discovers skills from .claude/skills/ directory [16.00ms]
(pass) discovers global skills from ~/.claude/skills/ directory [17.00ms]
(pass) returns empty array when no skills exist [22.00ms]

test/snapshot/snapshot.test.ts:
(pass) tracks deleted files correctly [38.01ms]
(pass) revert should remove new files [44.01ms]
(pass) revert in subdirectory [43.01ms]
(pass) multiple file operations [53.01ms]
(pass) empty directory handling [35.01ms]
(pass) binary file handling [44.01ms]
(pass) symlink handling [36.01ms]
(pass) large file handling [48.01ms]
(pass) nested directory revert [45.01ms]
(pass) special characters in filenames [38.01ms]
(pass) revert with empty patches [25.00ms]
(pass) patch with invalid hash [36.01ms]
(pass) revert non-existent file [38.01ms]
(pass) unicode filenames [38.01ms]
(pass) very long filenames [38.01ms]
(pass) hidden files [40.01ms]
(pass) nested symlinks [41.01ms]
(pass) file permissions and ownership changes [44.01ms]
(pass) circular symlinks [44.01ms]
(pass) gitignore changes [38.01ms]
(pass) concurrent file operations during patch [45.01ms]
(pass) snapshot state isolation between projects [74.01ms]
(pass) patch detects changes in secondary worktree [63.01ms]
(pass) revert only removes files in invoking worktree [66.01ms]
(pass) diff reports worktree-only/shared edits and ignores primary-only [60.01ms]
(pass) track with no changes returns same hash [37.01ms]
(pass) diff function with various changes [39.01ms]
(pass) restore function [39.01ms]
(pass) revert should not delete files that existed but were deleted in snapshot [44.01ms]
(pass) revert preserves file that existed in snapshot when deleted then recreated [43.01ms]
(pass) diffFull with new file additions [47.01ms]
(pass) diffFull with file modifications [43.01ms]
(pass) diffFull with file deletions [46.01ms]
(pass) diffFull with multiple line additions [45.01ms]
(pass) diffFull with addition and deletion [49.01ms]
(pass) diffFull with multiple additions and deletions [54.01ms]
(pass) diffFull with no changes [39.01ms]
(pass) diffFull with binary file changes [41.01ms]
(pass) diffFull with whitespace changes [44.01ms]

test/ide/ide.test.ts:
(pass) ide > should detect Visual Studio Code
(pass) ide > should detect Visual Studio Code Insiders
(pass) ide > should detect Cursor
(pass) ide > should detect VSCodium
(pass) ide > should detect Windsurf
(pass) ide > should return unknown when TERM_PROGRAM is not vscode
(pass) ide > should return unknown when GIT_ASKPASS does not contain IDE name [1.00ms]
(pass) ide > should recognize vscode-insiders ATOMCLI_CALLER
(pass) ide > should recognize vscode ATOMCLI_CALLER
(pass) ide > should return false for unknown ATOMCLI_CALLER

test/server/session-select.test.ts:
(pass) tui.selectSession endpoint > should return 200 when called with valid session [16.00ms]
(pass) tui.selectSession endpoint > should return 404 when session does not exist [1.00ms]
(pass) tui.selectSession endpoint > should return 400 when session ID format is invalid [1.00ms]

test/cli/github-action.test.ts:
(pass) extractResponseText > returns text from text part [1.00ms]
(pass) extractResponseText > returns last text part when multiple exist
(pass) extractResponseText > returns text even when tool parts follow
(pass) extractResponseText > returns null for reasoning-only response (signals summary needed)
(pass) extractResponseText > returns null for tool-only response (signals summary needed)
(pass) extractResponseText > returns null for multiple completed tools
(pass) extractResponseText > ignores running tool parts (throws since no completed tools)
(pass) extractResponseText > throws with part types on empty array
(pass) extractResponseText > throws with part types on unhandled parts
(pass) extractResponseText > prefers text over reasoning when both present
(pass) extractResponseText > prefers text over tools when both present

test/cli/github-remote.test.ts:
(pass) parses https URL with .git suffix
(pass) parses https URL without .git suffix
(pass) parses git@ URL with .git suffix
(pass) parses git@ URL without .git suffix
(pass) parses ssh:// URL with .git suffix
(pass) parses ssh:// URL without .git suffix
(pass) parses http URL
(pass) parses URL with hyphenated owner and repo names
(pass) parses URL with underscores in names
(pass) parses URL with numbers in names
(pass) parses repos with dots in the name
(pass) returns null for non-github URLs
(pass) returns null for invalid URLs
(pass) returns null for URLs with extra path segments

test/cli/tui/transcript.test.ts:
(pass) transcript > formatAssistantHeader > includes metadata when enabled
(pass) transcript > formatAssistantHeader > excludes metadata when disabled
(pass) transcript > formatAssistantHeader > handles missing completed time
(pass) transcript > formatAssistantHeader > titlecases agent name
(pass) transcript > formatPart > formats text part
(pass) transcript > formatPart > skips synthetic text parts
(pass) transcript > formatPart > formats reasoning when thinking enabled
(pass) transcript > formatPart > skips reasoning when thinking disabled
(pass) transcript > formatPart > formats tool part with details
(pass) transcript > formatPart > formats tool part without details when disabled
(pass) transcript > formatPart > formats tool error
(pass) transcript > formatMessage > formats user message
(pass) transcript > formatMessage > formats assistant message with metadata
(pass) transcript > formatTranscript > formats complete transcript [1.00ms]
(pass) transcript > formatTranscript > formats transcript without assistant metadata [1.00ms]
----------------------------------------------------------------------------------------|---------|---------|-------------------
File                                                                                    | % Funcs | % Lines | Uncovered Line #s
----------------------------------------------------------------------------------------|---------|---------|-------------------
All files                                                                               |   44.38 |   59.87 |
 src/agent/agent.ts                                                                     |   83.33 |   87.10 | 259,263-297
 src/auth/index.ts                                                                      |   77.78 |   83.93 | 59-62,66-70
 src/bun/index.ts                                                                       |   90.00 |   92.31 | 119-124,126-127
 src/bus/bus-event.ts                                                                   |  100.00 |  100.00 | 
 src/bus/global.ts                                                                      |  100.00 |  100.00 | 
 src/bus/index.ts                                                                       |   70.00 |   75.00 | 26-36,73-81
 src/cli/bootstrap.ts                                                                   |    0.00 |   14.29 | 4-15
 src/cli/cmd/cmd.ts                                                                     |  100.00 |  100.00 | 
 src/cli/cmd/github.ts                                                                  |   54.55 |    3.79 | 187,193-407,415-1543
 src/cli/cmd/tui/event.ts                                                               |  100.00 |  100.00 | 
 src/cli/cmd/tui/util/transcript.ts                                                     |  100.00 |  100.00 | 
 src/cli/ui.ts                                                                          |   12.50 |   54.41 | 34-35,39-40,45-47,51-60,64-75,79
 src/command/index.ts                                                                   |   20.00 |   36.84 | 43-49,58-120,124
 src/config/config.ts                                                                   |   89.13 |   91.48 | 50,69-70,83-84,110-111,147,152-161,175,178,221-222,224-233,235-245,267-268,273-275,287-288,302-303,305-317,475,995-996,998-1000,1088-1093,1107,1126,1130,1136-1146
 src/config/markdown.ts                                                                 |   66.67 |   63.89 | 13,23-29,34-38
 src/env/index.ts                                                                       |   83.33 |   87.50 | 22-23
 src/file/ignore.ts                                                                     |  100.00 |   90.48 | 68,74,76-79
 src/file/index.ts                                                                      |   50.00 |   35.97 | 82,84-87,89-90,92-108,122-197,201,205-271,289,295-298,307-317,327-336,364-367,372-408
 src/file/ripgrep.ts                                                                    |   62.50 |   39.84 | 159-161,165-174,176-181,183-192,208-270,275-373,377-413
 src/file/time.ts                                                                       |   90.91 |   93.48 | 59-61
 src/file/watcher.ts                                                                    |   20.00 |   30.39 | 35-38,43-103,106-107,112-115
 src/flag/flag.ts                                                                       |  100.00 |   97.78 | 
 src/format/formatter.ts                                                                |    0.00 |   60.20 | 18-19,27-28,66-73,84-92,130-138,146-147,155-157,165-166,174-196,204-222,231-238,246-247,255-256,264-265,273-274,282-285,293-294,302-303,311-312,320-321,329-330,338-345,353-356
 src/format/index.ts                                                                    |   16.67 |   20.49 | 26-62,66-72,76-85,89-99,103-134
 src/global/index.ts                                                                    |   75.00 |  100.00 | 
 src/id/id.ts                                                                           |  100.00 |   92.98 | 37,39-41
 src/ide/index.ts                                                                       |   75.00 |   63.49 | 51-73
 src/installation/index.ts                                                              |   37.50 |   28.25 | 45-48,60-102,113-117,121-160,168-202
 src/lsp/client.ts                                                                      |   60.00 |   48.64 | 52-60,63-64,67-68,117-123,130-132,140-141,147-203,206-236
 src/lsp/index.ts                                                                       |   44.44 |   49.75 | 67-70,86-92,102-123,125,141,146,162-173,189-191,196,198-205,207,209-212,214-218,220,233-234,239-242,257-258,264-273,281-283,286,294-298,303-315,359-367,371-382,386-393,397-405,409-416,420-427,431-440,444-453,463-465,470-481
 src/lsp/language.ts                                                                    |  100.00 |  100.00 | 
 src/lsp/server.ts                                                                      |   31.15 |   17.33 | 16-19,74-84,100-113,121-162,174-180,182-183,185-188,190-192,194-195,197-202,204-206,208-209,211-217,219-220,266-275,284-288,340-342,344-350,352-353,360-362,365-395,403-436,452-500,508-554,562-616,624-728,736-768,776-808,816-842,849-875,878-888,896-1034,1042-1074,1082-1125,1133-1212,1220-1303,1311-1351,1367-1491,1499-1535,1543-1553,1561-1571,1579-1589,1596-1627,1635-1717,1725-1807,1815-1846,1854-1864,1872-1885,1893-1916,1924-2010,2018-2028
 src/mcp/auth.ts                                                                        |    7.14 |   40.86 | 34-35,43-52,56-57,61-68,72-76,80-82,86-88,92-94,98-102,106-108,112-113,117-121,129-132
 src/mcp/index.ts                                                                       |   27.03 |   30.62 | 104-107,112-139,166-167,172-173,182,191-200,206-224,228-246,254-261,268-270,272-273,279-283,306,350,353-357,359-365,367-368,370-375,377,395-407,409-431,436-439,447,449-450,452-456,458-470,472-475,479-490,494,498-526,530-538,542-571,575-592,596-613,617-641,645-668,676-744,753-785,792-828,836-840,847-851,858-859,868-871
 src/mcp/oauth-callback.ts                                                              |   12.50 |    8.23 | 26-41,57-148,152-157,161-179,183-193
 src/mcp/oauth-provider.ts                                                              |    8.33 |    9.16 | 31-149
 src/patch/index.ts                                                                     |   95.45 |   69.68 | 102,126-128,153,202-203,229,257-261,282-286,288,346-350,370-374,380,419-420,426-427,462,523-618
 src/permission/arity.ts                                                                |  100.00 |  100.00 | 
 src/permission/next.ts                                                                 |   86.96 |   93.84 | 198-199,201-209,252
 src/plugin/codex.ts                                                                    |   27.78 |   12.99 | 18-23,27-31,35-37,41,81-82,85-97,108-122,126-138,184-226,242-309,313-317,321-344,351-483,490-513
 src/plugin/index.ts                                                                    |   72.73 |   70.10 | 58,81-94,102-115
 src/project/bootstrap.ts                                                               |    0.00 |   46.43 | 15-29
 src/project/instance.ts                                                                |   93.75 |   81.54 | 64-75
 src/project/project.ts                                                                 |   69.70 |   82.29 | 66-71,91-96,125-130,148-153,250,252-260,262,267-269,273-274,306-313
 src/project/state.ts                                                                   |   62.50 |   52.17 | 35,37,39-46,48-50,52-54,56,58-62
 src/project/vcs.ts                                                                     |   16.67 |   50.00 | 31-37,42-61,64,69
 src/provider/antigravity/constants.ts                                                  |    0.00 |   93.48 | 90-92
 src/provider/antigravity/index.ts                                                      |    0.00 |   11.11 | 28-56,63,70-77,84-114,123-133,140-147
 src/provider/antigravity/oauth.ts                                                      |    0.00 |    3.59 | 45-47,51,55-62,69-86,93-116,124-179,187-226,234-271
 src/provider/antigravity/storage.ts                                                    |    0.00 |   12.20 | 26-27,31-39,44-51,55-87,91-97,101-109,113-116
 src/provider/auth.ts                                                                   |   16.67 |   46.83 | 11-17,31-39,59-69,80-115,125-128
 src/provider/models.ts                                                                 |   75.00 |   86.02 | 89-100
 src/provider/ollama.ts                                                                 |   88.89 |   86.73 | 32-39,55,73-75,190-192
 src/provider/provider.ts                                                               |   82.86 |   76.13 | 98-101,116,132-135,148-149,157-161,169-173,181-185,195-199,256-336,368-376,385-393,403-404,413-414,437-443,445-448,450-452,455-458,461-464,466,850-851,855,858-864,867-882,914-920,978,995-1013,1029,1031-1036,1039,1041-1048,1091-1099,1139,1143,1148-1150,1153-1156
 src/provider/sdk/openai-compatible/src/index.ts                                        |  100.00 |  100.00 | 
 src/provider/sdk/openai-compatible/src/openai-compatible-provider.ts                   |   16.67 |   61.11 | 56,68-73,77-82
 src/provider/sdk/openai-compatible/src/responses/convert-to-openai-responses-input.ts  |    0.00 |    3.50 | 16-17,21-294
 src/provider/sdk/openai-compatible/src/responses/map-openai-responses-finish-reason.ts |    0.00 |    0.00 | 3-19
 src/provider/sdk/openai-compatible/src/responses/openai-error.ts                       |    0.00 |  100.00 | 
 src/provider/sdk/openai-compatible/src/responses/openai-responses-language-model.ts    |    0.00 |   21.02 | 138-139,146-1295,1517-1519,1523-1525,1529-1533,1537-1539,1543-1545,1549-1551,1554-1556,1560-1562,1566-1568,1572-1574,1578-1582,1586-1588,1592-1594,1598-1600,1604,1616-1667
 src/provider/sdk/openai-compatible/src/responses/openai-responses-prepare-tools.ts     |    0.00 |    3.57 | 13-174
 src/provider/sdk/openai-compatible/src/responses/tool/code-interpreter.ts              |    0.00 |   91.89 | 84-86
 src/provider/sdk/openai-compatible/src/responses/tool/file-search.ts                   |    0.00 |  100.00 | 
 src/provider/sdk/openai-compatible/src/responses/tool/image-generation.ts              |    0.00 |   91.43 | 111-113
 src/provider/sdk/openai-compatible/src/responses/tool/local-shell.ts                   |  100.00 |  100.00 | 
 src/provider/sdk/openai-compatible/src/responses/tool/web-search-preview.ts            |  100.00 |  100.00 | 
 src/provider/sdk/openai-compatible/src/responses/tool/web-search.ts                    |    0.00 |   93.62 | 99-101
 src/provider/transform.ts                                                              |   78.57 |   65.38 | 12-14,59-62,64-77,79-80,82,85-97,126,128-132,134,164-171,210-214,236-247,251-257,261-267,445-450,456-457,465-470,474-476,478-480,482-484,486-490,495-514,518-549,602,606,613,615-617,627,643-651
 src/pty/index.ts                                                                       |    8.33 |    4.93 | 15-226
 src/question/index.ts                                                                  |  100.00 |  100.00 | 
 src/server/error.ts                                                                    |  100.00 |  100.00 | 
 src/server/mdns.ts                                                                     |   33.33 |   16.33 | 10-39,44-54
 src/server/project.ts                                                                  |    0.00 |   90.28 | 27-28,49,73-76
 src/server/question.ts                                                                 |    0.00 |   86.36 | 26-27,56-62,90-92
 src/server/routes/agent.ts                                                             |    0.00 |   92.00 | 24-25
 src/server/routes/auth.ts                                                              |    0.00 |   88.89 | 33-36
 src/server/routes/command.ts                                                           |    0.00 |   91.67 | 23-24
 src/server/routes/config.ts                                                            |    0.00 |   87.65 | 31,54-56,82-87
 src/server/routes/file.ts                                                              |    0.00 |   89.87 | 30-32,59-61,82-83
 src/server/routes/find.ts                                                              |    0.00 |   77.57 | 33-39,69-79,106-111
 src/server/routes/global.ts                                                            |    0.00 |   68.63 | 31,57-81,102-107
 src/server/routes/instance.ts                                                          |    0.00 |   86.57 | 30-31,54-56,77-78,112-118,140-143
 src/server/routes/mcp.ts                                                               |    0.00 |   80.45 | 39-41,59-63,79-82,97-101,116-118,130-132,144-146
 src/server/routes/permission.ts                                                        |    0.00 |   82.98 | 35-40,69-76,97-98
 src/server/routes/provider.ts                                                          |    0.00 |   69.70 | 35-68,89,123-129,164-171
 src/server/routes/pty.ts                                                               |    0.00 |   83.23 | 27,50-51,74-78,102-103,126-127,151-164
 src/server/routes/session/core.ts                                                      |    0.00 |   85.91 | 39-48,70-71,100-102,131-133,161-163,186-188,216-218,257-267,297-300,328-331,359-360,388-391
 src/server/routes/session/index.ts                                                     |  100.00 |  100.00 | 
 src/server/routes/session/message.ts                                                   |    0.00 |   79.02 | 41-46,80-85,114-120,150-162,196-203,228-234
 src/server/routes/session/tool.ts                                                      |    0.00 |   81.82 | 44-50,86-109,137-138,172-175,204-207,236-239,267-269,297-300
 src/server/routes/system.ts                                                            |    0.00 |   53.64 | 43-61,82-113
 src/server/routes/tool.ts                                                              |    0.00 |   85.71 | 29,71-80
 src/server/server.ts                                                                   |   78.57 |   62.26 | 67-68,71-75,99-101,104-109,164-176,181-192,196-234
 src/server/tui.ts                                                                      |   33.33 |   81.72 | 20-25,47-48,70-72,123-140,162-163,200-202
 src/session/compaction.ts                                                              |   50.00 |   24.52 | 49-88,92-191,205-221
 src/session/index.ts                                                                   |   63.41 |    3.42 | 1-444,454,466-472
 src/session/llm.ts                                                                     |   33.33 |    9.36 | 46-222,226-232
 src/session/message-v2.ts                                                              |   81.25 |   88.23 | 587-600,606-621,636-663,665,667-678
 src/session/processor.ts                                                               |   50.00 |    4.48 | 20-403
 src/session/prompt.ts                                                                  |   18.75 |   10.23 | 70-75,151-178,182-241,245-252,256-266,270-644,648-651,655-814,818-1225,1229-1253,1269-1484,1521-1633,1637-1705
 src/session/prompt/builder.ts                                                          |    0.00 |   50.50 | 40-46,97-112,119-120,127,134,141-163
 src/session/retry.ts                                                                   |   87.50 |   65.28 | 17-18,36,64,66-86
 src/session/revert.ts                                                                  |   72.73 |   76.60 | 36,63,67-75,92-102
 src/session/status.ts                                                                  |   20.00 |   67.74 | 44-45,49-52,57,61-73
 src/session/summary.ts                                                                 |   16.67 |   17.61 | 28-32,37-60,64-153,162,167-191
 src/session/system.ts                                                                  |   16.67 |   15.00 | 23-24,28,32-37,41-143,158,161-217
 src/session/todo.ts                                                                    |   33.33 |   82.76 | 27-28,32-34
 src/share/share-next.ts                                                                |   44.44 |   15.79 | 14,18-61,65-77,112-143,151-159,163-191
 src/share/share.ts                                                                     |   20.00 |   21.33 | 13-44,48-64,72-77,81-84
 src/shell/shell.ts                                                                     |   40.00 |   24.56 | 9-32,38-52,56-58
 src/skill/index.ts                                                                     |  100.00 |  100.00 | 
 src/skill/skill.ts                                                                     |   80.00 |   92.50 | 49,86,91-92,94-95,123-124
 src/snapshot/index.ts                                                                  |  100.00 |   90.70 | 84-89,112-114,135-141
 src/storage/storage.ts                                                                 |   88.10 |   50.75 | 31-34,36-56,58-60,62-73,75-98,100-117,125-138,205-206
 src/tool/bash.ts                                                                       |   75.00 |   92.02 | 28,80,85,104-105,198-199,202-203,209-210,226-228,236,240
 src/tool/batch.ts                                                                      |    0.00 |    3.49 | 8-173
 src/tool/chainupdate.ts                                                                |    0.00 |   23.74 | 61-166
 src/tool/codesearch.ts                                                                 |    0.00 |   25.71 | 51-128
 src/tool/edit.ts                                                                       |   89.47 |   55.62 | 36,129-132,156-170,183,196,200-203,205-211,213,224,226-228,230-232,235-239,242-248,251-253,256-258,260-261,263-272,275-279,281,284-299,302-303,305-307,309-310,312-324,326,329-333,336-349,362,388-393,420,427-447,469,494,497-499,502-503,505-506,508-510,519,522-524,526,529-530,533-534,537-538,540-541,545-547,549-551,553-559,561-568,592-601,603,610
 src/tool/external-directory.ts                                                         |  100.00 |  100.00 | 
 src/tool/finance/index.ts                                                              |    0.00 |   15.65 | 49-160,187-237,242-261,266-303
 src/tool/finance/logic.ts                                                              |   81.82 |   59.62 | 37-41,43-47,67,69-71,88-92,96-99,103-106,110-113,154,156,165,168,189-227,265-267,295,297,302,304,313,315
 src/tool/finance/providers/crypto.ts                                                   |    0.00 |    5.56 | 40-52,62-75,83-107,119-142,149-170,177-217,225-259,266-309,320-332,339-347,354-369,380-412
 src/tool/finance/providers/yahoo.ts                                                    |    0.00 |   21.79 | 24-29,37-55,68-102,116-156,167-186,197-213,240
 src/tool/finance/symbols.ts                                                            |  100.00 |   93.43 | 326-334,336,384-388,412-418
 src/tool/finance/technical.ts                                                          |  100.00 |   96.46 | 72,179,191,210,213,250
 src/tool/finance/types.ts                                                              |  100.00 |  100.00 | 
 src/tool/glob.ts                                                                       |    0.00 |   25.33 | 19-74
 src/tool/grep.ts                                                                       |   75.00 |   93.69 | 21,64,99-103
 src/tool/invalid.ts                                                                    |    0.00 |   60.00 | 9-14
 src/tool/ls.ts                                                                         |    0.00 |   35.04 | 43-118
 src/tool/lsp.ts                                                                        |    0.00 |   31.18 | 30-93
 src/tool/mcpadd.ts                                                                     |   50.00 |   41.22 | 65-151
 src/tool/patch.ts                                                                      |   83.33 |   80.82 | 76,88,108,110-112,114-119,121,156-157,159-162,164,166-169,171-173
 src/tool/question.ts                                                                   |    0.00 |   32.26 | 10-30
 src/tool/read.ts                                                                       |   87.50 |   82.35 | 56,149-176
 src/tool/registry.ts                                                                   |   14.29 |   27.27 | 36-61,65-80,84-90,94-120,124,128-146
 src/tool/skill.ts                                                                      |    0.00 |   13.89 | 12-73
 src/tool/skilladd.ts                                                                   |    0.00 |   28.26 | 27-92
 src/tool/task.ts                                                                       |    0.00 |   11.80 | 23-179
 src/tool/todo.ts                                                                       |    0.00 |   28.57 | 10-28,35-50
 src/tool/tool.ts                                                                       |  100.00 |   82.05 | 59-65
 src/tool/truncation.ts                                                                 |   87.50 |   97.22 | 71-72
 src/tool/webfetch.ts                                                                   |   40.00 |   62.00 | 55,78,83,95-100,110-115,131-134,140-168,172-180
 src/tool/websearch.ts                                                                  |   66.67 |   85.29 | 108-109,125-127,129-135,137-139
 src/tool/write.ts                                                                      |   66.67 |   83.33 | 56-67
 src/util/archive.ts                                                                    |   50.00 |   33.33 | 5-12
 src/util/color.ts                                                                      |  100.00 |  100.00 | 
 src/util/context.ts                                                                    |   66.67 |    9.09 | 1-20
 src/util/defer.ts                                                                      |    0.00 |    0.00 | 1-10
 src/util/filesystem.ts                                                                 |   63.64 |   55.38 | 13-15,19-21,58-80
 src/util/fn.ts                                                                         |   66.67 |  100.00 | 
 src/util/iife.ts                                                                       |  100.00 |  100.00 | 
 src/util/keybind.ts                                                                    |   83.33 |   85.51 | 24-31,90-91
 src/util/lazy.ts                                                                       |   66.67 |   83.33 | 12-13
 src/util/locale.ts                                                                     |   27.27 |   17.74 | 6-7,11-14,18-26,31-36,40-58,62-63,67-73,77-78
 src/util/lock.ts                                                                       |   84.62 |   68.66 | 30-32,37-38,59-66,85-92
 src/util/log.ts                                                                        |   88.46 |   96.72 | 50,53-54
 src/util/queue.ts                                                                      |    0.00 |   21.43 | 5-16,21-30
 src/util/timeout.ts                                                                    |  100.00 |  100.00 | 
 src/util/token.ts                                                                      |  100.00 |  100.00 | 
 src/util/wildcard.ts                                                                   |   77.78 |  100.00 | 
 src/worktree/index.ts                                                                  |   10.00 |   66.85 | 130,134-139,143,147-150,154-155,159,163-177,181-184,188-214
 test/fixture/fixture.ts                                                                |  100.00 |  100.00 | 
 test/preload.ts                                                                        |  100.00 |  100.00 | 
 ../libs/sdk/js/src/client.ts                                                           |   50.00 |   47.83 | 10-13,15-18,22-25
 ../libs/sdk/js/src/gen/client.gen.ts                                                   |  100.00 |  100.00 | 
 ../libs/sdk/js/src/gen/client/client.gen.ts                                            |   25.00 |   15.93 | 25-26,32-62,66-177,183-190
 ../libs/sdk/js/src/gen/client/index.ts                                                 |  100.00 |  100.00 | 
 ../libs/sdk/js/src/gen/client/utils.gen.ts                                             |   35.29 |   34.84 | 11-50,59-87,91-102,106-140,144-152,209,213-216,220-221,225-228,232-237,242-243
 ../libs/sdk/js/src/gen/core/auth.gen.ts                                                |    0.00 |    5.26 | 22-39
 ../libs/sdk/js/src/gen/core/bodySerializer.gen.ts                                      |    0.00 |   22.00 | 15-20,25-28,34-47,53,58-71
 ../libs/sdk/js/src/gen/core/params.gen.ts                                              |    0.00 |   11.11 | 50-67,78-82,86-142
 ../libs/sdk/js/src/gen/core/pathSerializer.gen.ts                                      |    0.00 |    4.76 | 28-36,41-49,54-62,67-105,109-119,123-165
 ../libs/sdk/js/src/gen/core/serverSentEvents.gen.ts                                    |    0.00 |    0.69 | 66-208
 ../libs/sdk/js/src/gen/core/utils.gen.ts                                               |    0.00 |    4.40 | 18-79,83-107
 ../libs/sdk/js/src/gen/sdk.gen.ts                                                      |    1.25 |   26.42 | 223,237-240,249-252,259-262,271-274,281-288,295-298,305-308,315-322,329-332,341-344,351-358,365-368,377-380,387-390,399-402,411-414,423-426,435-438,445-452,459-462,469-472,479-482,489-496,503-506,513-516,523-530,537-544,551-554,561-564,571-574,581-584,591-598,605-608,615-622,629-632,639-646,653-660,667-674,681-688,695-698,707-710,719-730,737-748,757-760,767-770,780-783,790-793,800-803,812-815,822-825,832-835,844-851,858-861,870-873,880-883,890-897,904-909,916-923,932-935,942-949,956-959,966-969,980-983,992-995,1004-1007,1014-1021,1030-1037,1044-1047,1054-1057,1064-1067,1074-1077,1084-1087,1094-1097,1104-1111,1118-1125,1132-1139,1149-1152,1161-1174
 ../libs/sdk/js/src/gen/types.gen.ts                                                    |  100.00 |  100.00 | 
 ../libs/sdk/js/src/index.ts                                                            |    0.00 |   25.00 | 8-19
 ../libs/sdk/js/src/server.ts                                                           |    0.00 |    2.00 | 21-89,93-121
 ../libs/util/src/error.ts                                                              |   71.43 |   92.50 | 1-2
 ../libs/util/src/fn.ts                                                                 |   66.67 |  100.00 | 
 ../libs/util/src/lazy.ts                                                               |   50.00 |   37.50 | 5-9
----------------------------------------------------------------------------------------|---------|---------|-------------------

 711 pass
 0 fail
 1492 expect() calls
Ran 711 tests across 47 files. [46.06s]
