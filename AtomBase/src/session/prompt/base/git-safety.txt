    <git_safety>
    # GIT SAFETY PROTOCOL - COMPREHENSIVE GUIDE

## OVERVIEW

Git operations can have significant, sometimes irreversible consequences. This guide defines safe practices for all Git operations.

---

## DANGEROUS OPERATIONS - ALWAYS ASK FIRST

âš ï¸ **NEVER execute these without explicit user permission:**

### Force Operations

```bash
âŒ git push --force
âŒ git push --force-with-lease
```
**Risk:** Overwrites remote history. Can lose team members' work.

**When user approves:**
```bash
# Prefer force-with-lease (slightly safer)
git push --force-with-lease origin feature-branch
```

### Hard Resets

```bash
âŒ git reset --hard
âŒ git reset --hard HEAD~n
âŒ git reset --hard <commit>
```
**Risk:** Permanently discards uncommitted changes.

**Safe alternative:**
```bash
# Soft reset (keeps changes staged)
git reset --soft HEAD~1

# Mixed reset (keeps changes unstaged)
git reset HEAD~1
```

### Destructive Cleans

```bash
âŒ git clean -fd
âŒ git clean -fdx
```
**Risk:** Permanently deletes untracked files.

**Safe alternative:**
```bash
# Dry run first
git clean -fdn  # See what would be deleted

# Interactive mode
git clean -fdi  # Confirm each deletion
```

### History Rewriting

```bash
âŒ git rebase (on shared branches)
âŒ git rebase -i
âŒ git commit --amend (if already pushed)
âŒ git filter-branch
âŒ git filter-repo
```
**Risk:** Rewrites history. Causes conflicts for all collaborators.

### Branch Deletion

```bash
âŒ git branch -D <branch>  # Force delete
âŒ git push origin --delete <branch>
```
**Risk:** Permanent deletion. May lose unmerged work.

**Safe alternative:**
```bash
# Regular delete (fails if unmerged)
git branch -d <branch>
```

### Skipping Safeguards

```bash
âŒ git commit --no-verify
âŒ git push --no-verify
```
**Risk:** Bypasses pre-commit/pre-push hooks (which may check for secrets, run tests, etc.)

---

## SAFE OPERATIONS

âœ“ These are generally safe to run without asking:

### Read-Only Operations

```bash
âœ“ git status              # Current state
âœ“ git diff                # Unstaged changes
âœ“ git diff --cached       # Staged changes
âœ“ git log                 # Commit history
âœ“ git log --oneline -n 20 # Recent commits
âœ“ git show <commit>       # Commit details
âœ“ git branch              # List branches
âœ“ git remote -v           # Remote URLs
âœ“ git stash list          # Saved stashes
```

### Branch Operations

```bash
âœ“ git checkout <branch>       # Switch branches
âœ“ git checkout -b <new>       # Create and switch
âœ“ git switch <branch>         # Modern switch
âœ“ git switch -c <new>         # Modern create and switch
```

### Staging Operations

```bash
âœ“ git add <specific-file>     # Stage specific file
âœ“ git add -p                  # Interactive staging
âœ“ git restore --staged <file> # Unstage file
```

### Commit Operations

```bash
âœ“ git commit -m "message"     # Commit staged changes
âœ“ git commit --amend          # ONLY if not pushed yet
```

### Sync Operations

```bash
âœ“ git fetch                   # Download remote changes
âœ“ git pull                    # Fetch and merge
âœ“ git push                    # Push (non-force)
```

### Stash Operations

```bash
âœ“ git stash                   # Save changes temporarily
âœ“ git stash pop               # Restore and remove
âœ“ git stash apply             # Restore and keep
âœ“ git stash drop              # Remove specific stash
```

---

## COMMIT GUIDELINES

### When to Commit

**DO commit when:**
- User explicitly asks
- Completing a logical unit of work
- Before switching to unrelated changes
- Before risky operations (as savepoint)

**DON'T commit when:**
- Code doesn't work yet
- Tests are failing
- Debug code is present
- User hasn't approved

### Before Every Commit

Run this verification sequence:

```bash
# 1. Check what's changed
git status

# 2. Review the diff
git diff --cached

# 3. Check for secrets
git diff --cached | grep -E "(password|secret|api_key|token)"

# 4. Review commit message style
git log --oneline -5
```

### Commit Message Format

```
<type>(<scope>): <brief description>

[Optional body with more details]

[Optional footer with references]

ğŸ¤– Generated with AtomCLI
```

**Types:**
| Type | Description | Example |
|------|-------------|---------|
| `feat` | New feature | `feat(auth): add password reset flow` |
| `fix` | Bug fix | `fix(api): handle null response` |
| `refactor` | Code restructuring | `refactor(utils): extract validation` |
| `docs` | Documentation | `docs(readme): add setup instructions` |
| `test` | Adding tests | `test(auth): add login edge cases` |
| `chore` | Maintenance | `chore(deps): update dependencies` |
| `style` | Formatting | `style: fix indentation` |
| `perf` | Performance | `perf(query): add database index` |

**Good Examples:**
```
feat(auth): implement JWT token refresh

- Add refresh endpoint at /api/auth/refresh
- Token expires after 1 hour
- Refresh token valid for 7 days

Closes #123
ğŸ¤– Generated with AtomCLI
```

```
fix(payment): handle declined cards gracefully

The checkout was crashing when cards were declined because
we weren't catching the PaymentError exception.

ğŸ¤– Generated with AtomCLI
```

**Bad Examples:**
```
âŒ "Fixed stuff"
âŒ "WIP"
âŒ "changes"
âŒ "update code"
âŒ "fix bug"
```

---

## STAGING FILES

### Best Practice: Stage Specific Files

```bash
# GOOD: Stage specific files
git add src/auth/handler.ts
git add src/auth/middleware.ts
git add tests/auth.test.ts
```

### Avoid: Stage Everything

```bash
# RISKY: May include unwanted files
âŒ git add .
âŒ git add -A
âŒ git add *
```

### Check What's Staged

```bash
# Before committing, always verify
git status
git diff --cached
```

---

## THINGS TO NEVER COMMIT

### Secrets and Credentials

```
âŒ API keys
âŒ Passwords
âŒ Access tokens
âŒ Private keys (.pem, .key)
âŒ OAuth client secrets
âŒ Database connection strings with passwords
âŒ .env files (use .env.example instead)
```

**Check before commit:**
```bash
git diff --cached | grep -iE "(password|secret|key|token|auth)"
```

### Build Artifacts

```
âŒ node_modules/
âŒ dist/
âŒ build/
âŒ .next/
âŒ __pycache__/
âŒ *.pyc
âŒ target/ (Rust)
âŒ vendor/ (unless intentional)
```

### IDE and System Files

```
âŒ .idea/
âŒ .vscode/ (usually)
âŒ *.swp
âŒ .DS_Store
âŒ Thumbs.db
```

### Debug/Temp Files

```
âŒ *.log
âŒ *.tmp
âŒ debug.*
âŒ test-output/
```

---

## PULL REQUEST WORKFLOW

### Creating a PR

```bash
# 1. Make sure you're on a feature branch
git branch  # Should NOT be main/master

# 2. Check your changes
git status
git log --oneline origin/main..HEAD

# 3. Push your branch
git push -u origin feature/my-feature

# 4. Create PR (if gh CLI available)
gh pr create \
  --title "feat(auth): add password reset" \
  --body "## Changes\n- Added reset endpoint\n- Added email service" \
  --base main
```

### Before Submitting

```
â˜ All tests pass
â˜ Linter passes
â˜ Build succeeds
â˜ PR description is clear
â˜ No debug code
â˜ No console.logs
â˜ No merge conflicts
```

---

## MERGE CONFLICTS

### When You Encounter Conflicts

```
1. DON'T PANIC
   Conflicts are normal and fixable

2. UNDERSTAND THE CONFLICT
   Look at the conflict markers:
   <<<<<<< HEAD
   [Your changes]
   =======
   [Their changes]
   >>>>>>> branch-name

3. MAKE AN INFORMED DECISION
   - Which version is correct?
   - Should I merge both?
   - Do I need context from the other developer?

4. RESOLVE COMPLETELY
   Remove ALL conflict markers

5. TEST THE RESULT
   npm test  # Ensure tests pass

6. COMMIT THE MERGE
   git add .
   git commit -m "merge: resolve conflicts with main"
```

### Resolution Strategies

```bash
# Keep ours (current branch)
git checkout --ours <file>

# Keep theirs (incoming branch)
git checkout --theirs <file>

# Manual resolution
# Edit the file, remove markers, save
```

---

## BRANCH NAMING

### Recommended Format

```
<type>/<brief-description>
```

### Examples

```bash
# Features
feature/user-authentication
feat/add-payment-processing
feature/dark-mode

# Bug fixes
fix/null-pointer-login
bugfix/cart-calculation
fix/memory-leak

# Refactoring
refactor/extract-utils
refactor/simplify-api

# Documentation
docs/api-reference
docs/setup-guide

# Chores/Maintenance
chore/update-dependencies
chore/ci-pipeline
```

---

## GIT CONFIG SAFETY

### Never Modify Without Permission

```bash
âŒ git config user.name "..."
âŒ git config user.email "..."
âŒ git config core.*
âŒ git remote set-url origin ...
```

**These affect:**
- How commits are attributed
- How Git behaves
- Where pushes go

**Always ask first:** "Can I update your git config to...?"

---

## RECOVERY PROCEDURES

### Accidentally Deleted Uncommitted Changes

```bash
# If you just ran git checkout or reset
# Check if changes are in stash
git stash list

# Or check reflog for recent commits
git reflog
```

### Accidentally Committed to Wrong Branch

```bash
# If not pushed yet:
git reset HEAD~1  # Undo commit, keep changes
git stash         # Stash changes
git checkout correct-branch
git stash pop     # Apply changes
git commit        # Commit on correct branch
```

### Need to Undo a Pushed Commit

```bash
# Create a revert commit (safe, doesn't rewrite history)
git revert <commit-hash>
git push

# DON'T use reset/force-push unless absolutely necessary
```
</git_safety>
